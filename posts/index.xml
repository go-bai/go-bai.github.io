<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on gobai's blog</title><link>/posts/</link><description>Recent content in Posts on gobai's blog</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Sat, 27 Jul 2024 22:57:08 +0800</lastBuildDate><atom:link href="/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>Libvirt</title><link>/posts/libvirt/</link><pubDate>Sat, 27 Jul 2024 22:57:08 +0800</pubDate><guid>/posts/libvirt/</guid><description>&lt;h2 id="virsh-å‘½ä»¤">&lt;code>virsh&lt;/code> å‘½ä»¤&lt;/h2>
&lt;h3 id="virsh-domifaddr-æŸ¥çœ‹è™šæ‹Ÿæœºç½‘å¡ip">&lt;code>virsh domifaddr&lt;/code> æŸ¥çœ‹è™šæ‹Ÿæœºç½‘å¡ip&lt;/h3>
&lt;pre>&lt;code class="language-bash"># virsh domifaddr k3s-node01 --source lease
 Name MAC address Protocol Address
-------------------------------------------------------------------------------
&lt;/code>&lt;/pre>
&lt;p>é€šè¿‡arpè·å–ç½‘å¡ip&lt;/p>
&lt;pre>&lt;code class="language-bash"># virsh domifaddr k3s-node01 --source arp
 Name MAC address Protocol Address
-------------------------------------------------------------------------------
 vnet18 52:54:00:0e:08:02 ipv4 192.168.1.248/0
&lt;/code>&lt;/pr</description></item><item><title>RKE2</title><link>/posts/rke2/</link><pubDate>Mon, 01 Jul 2024 21:24:49 +0800</pubDate><guid>/posts/rke2/</guid><description>&lt;blockquote>
&lt;p>é€šè¿‡RKE2å¿«é€Ÿæ­å»ºæµ‹è¯•ä½¿ç”¨çš„k8sé›†ç¾¤ç¯å¢ƒ&lt;/p>
&lt;/blockquote>
&lt;h2 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡&lt;/h2>
&lt;ol>
&lt;li>å‡†å¤‡bridgeç½‘ç»œbr0&lt;/li>
&lt;li>å‡†å¤‡ubuntu 22.04 server qcow2é•œåƒ&lt;/li>
&lt;li>å‡†å¤‡libvirtç¯å¢ƒ&lt;/li>
&lt;/ol>
&lt;h3 id="å‡†å¤‡bridgeç½‘ç»œ">å‡†å¤‡bridgeç½‘ç»œ&lt;/h3>
&lt;p>&lt;a href="../creating-a-bridged-network-with-netplan-on-ubuntu-22-04/">Creating a bridged network with netplan on Ubuntu 22.04&lt;/a>&lt;/p>
&lt;h3 id="é…ç½®-gen-cloudinit-iso-è„šæœ¬">é…ç½® gen-cloudinit-iso è„šæœ¬&lt;/h3>
&lt;pre>&lt;code class="language-bash">cat &amp;lt;&amp;lt;EOFALL &amp;gt; /usr/bin/gen-cloudinit-iso
#!/bin/bash

set -eux

CLOUD_INIT_DIR=&amp;quot;/var/lib/libvirt/disks/\${VM}/cloudinit&amp;quot;
FILENAME=&amp;quot;\${CLOUD_INIT_DIR}/init.iso&amp;quot;

mkdir -p \${CLOUD_INIT_DIR}

cat &amp;lt;&amp;lt;EOF &amp;gt; \${CLOUD_INIT_DIR}/meta-data
instance-id: \${VM}
local-hostname: \${VM}
EOF

# æ›´å¤šé…ç½®å‚ç…§ https://cloudinit.readthedocs.io/en/latest/explanation/format.html
cat &amp;lt;&amp;lt;EOF &amp;gt; \${CLOUD_INIT_DIR}/user-data
#cloud-config
EOF

# å‚è€ƒ kubevirt /pkg/cloud-init/cloud-init.go:defaultIsoFunc
xorrisofs -output \$FILENAME -volid cidata -joliet -rock -partition_cyl_align on \${CLOUD_INIT_DIR}/user-data \${CLOUD_INIT_DIR}/meta-data
EOFALL

chmod +x /usr/bin/gen-cloudinit-iso
&lt;/code>&lt;/pr</description></item><item><title>Cloudinit</title><link>/posts/cloudinit/</link><pubDate>Sun, 30 Jun 2024 23:56:57 +0800</pubDate><guid>/posts/cloudinit/</guid><description>&lt;h2 id="cloudinit-ä»‹ç»">cloudinit ä»‹ç»&lt;/h2>
&lt;blockquote>
&lt;p>ç”¨äºåœ¨æ–°å»ºçš„è™šæ‹Ÿæœºä¸­è¿›è¡Œæ—¶é—´è®¾ç½®ã€å¯†ç è®¾ç½®ã€æ‰©å±•æ ¹æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨åˆ†åŒºã€è®¾ç½®ä¸»æœºåã€è¿è¡Œè„šæœ¬ã€å®‰è£…è½¯ä»¶åŒ…ç­‰åˆå§‹åŒ–è®¾ç½®&lt;/p>
&lt;/blockquote>
&lt;h2 id="cloudinit-iso-é•œåƒåˆ¶ä½œ">cloudinit iso é•œåƒåˆ¶ä½œ&lt;/h2>
&lt;h3 id="åˆ›å»ºè„šæœ¬">åˆ›å»ºè„šæœ¬&lt;/h3>
&lt;pre>&lt;code class="language-bash">cat &amp;lt;&amp;lt;EOFALL &amp;gt; gen-cloudinit-iso.sh
#!/bin/bash

set -eux

CLOUD_INIT_DIR=&amp;quot;/var/lib/libvirt/disks/\${VM}/cloudinit&amp;quot;
FILENAME=&amp;quot;\${CLOUD_INIT_DIR}/init.iso&amp;quot;

mkdir -p \${CLOUD_INIT_DIR}

cat &amp;lt;&amp;lt;EOF &amp;gt; \${CLOUD_INIT_DIR}/meta-data
instance-id: \${VM}
local-hostname: \${VM}
EOF

# æ›´å¤šé…ç½®å‚ç…§ https://cloudinit.readthedocs.io/en/latest/explanation/format.html
cat &amp;lt;&amp;lt;EOF &amp;gt; \${CLOUD_INIT_DIR}/user-data
#cloud-config
EOF

# å‚è€ƒ kubevirt /pkg/cloud-init/cloud-init.go:defaultIsoFunc
xorrisofs -output \$FILENAME -volid cidata -joliet -rock -partition_cyl_align on \${CLOUD_INIT_DIR}/user-data \${CLOUD_INIT_DIR}/meta-data
EOFALL
&lt;/code>&lt;/pre>
&lt;h3 id="ç”Ÿæˆ-cloudinit-iso">ç”Ÿæˆ cloudinit iso&lt;/h3>
&lt;pre>&lt;code class="language-bash">VM=k8s-node01 bash gen-cloudinit-iso.sh
&lt;/code>&lt;/pr</description></item><item><title>Controller Runtime</title><link>/posts/controller-runtime/</link><pubDate>Sat, 01 Jun 2024 10:42:13 +0800</pubDate><guid>/posts/controller-runtime/</guid><description>&lt;blockquote>
&lt;p>&lt;a href="https://github.com/kubernetes-sigs/controller-runtime">controller-runtime&lt;/a>æ˜¯åœ¨&lt;a href="https://github.com/kubernetes/client-go/tree/master/tools/cache">client-go/tools/cache&lt;/a>å’Œ&lt;a href="https://github.com/kubernetes/client-go/tree/master/util/workqueue">client-go/util/workqueue&lt;/a>çš„åŸºç¡€ä¸Šå®ç°çš„, äº†è§£&lt;code>client-go/tools/cache&lt;/code>å’Œ&lt;code>client-go/util/workqueue&lt;/code>å¯¹ç†è§£&lt;code>controller-runtime&lt;/code>å¾ˆæœ‰å¸®åŠ©&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä»‹ç»informer">ä»‹ç»informer&lt;/h2>
&lt;p>å¸¦ç€é—®é¢˜çœ‹&lt;/p>
&lt;h2 id="å¼€å‘crdæ—¶æƒ³åˆ°çš„ä¸€äº›é—®é¢˜">å¼€å‘CRDæ—¶æƒ³åˆ°çš„ä¸€äº›é—®é¢˜&lt;/h2>
&lt;h3 id="æ›´æ–°local-storeç¼“å­˜å’Œè§¦å‘reconcileæ˜¯å¦æœ‰å…ˆåé¡ºåº">æ›´æ–°local storeç¼“å­˜å’Œè§¦å‘reconcileæ˜¯å¦æœ‰å…ˆåé¡ºåº&lt;/h3>
&lt;h3 id="åŒä¸€ä¸ªcrd-objectä¼šä¸ä¼šåŒæ—¶è¢«reconcile">åŒä¸€ä¸ªcrd objectä¼šä¸ä¼šåŒæ—¶è¢«reconcile&lt;/h3>
&lt;p>è¿™ä¸ªå…¨é Queueæ•°æ®ç»“æ„è®¾è®¡çš„ç²¾å¦™, ä¿è¯äº†æ­£åœ¨æ‰§è¡Œçš„reconcileä¸ä¼šå¤„ç†ç›¸åŒçš„object&lt;/p>
&lt;p>å‘queueä¸­å¢åŠ objectä¹‹å‰ä¼šæ£€æŸ¥æ˜¯å¦æœ‰æ¬¡objectå­˜åœ¨äºqueueä¸­ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åŠ å…¥dirty setï¼Œå¦‚æœä¹Ÿä¸å­˜åœ¨äºprocessing setæ‰ä¼šåŠ å…¥queueä¸­ï¼Œå½“processingä¸­çš„å¤„ç†å®Œæˆä¹‹åï¼ˆè°ƒç”¨Doneï¼‰ï¼Œä¼šå°†objectä»processing setç§ç§»é™¤ï¼Œå¦‚æœæ¬¡objectåœ¨å¤„ç†è¿‡ç¨‹ä¸­åŠ å…¥åˆ°äº†dirty setï¼Œåˆ™å°†objectå†æ¬¡åŠ å…¥åˆ°queueä¸­
&lt;a href="https://www.cnblogs.com/daniel-hutao/p/18010835/k8s_clientgo_workqueue">https://www.cnblogs.com/daniel-hutao/p/18010835/k8s_clientgo_workqueue&lt;/a>&lt;/p>
&lt;p>æœ‰å‡ ç§é˜Ÿåˆ—ï¼ŒQueueï¼ŒDelayingQueueï¼ŒRateLimitingQueue&lt;/p>
&lt;h3 id="å¦‚ä½•è§£å†³è¿›å…¥reconcileä¹‹åè¯»åˆ°çš„æ˜¯æ—§æ•°æ®çš„é—®é¢˜">å¦‚ä½•è§£å†³è¿›å…¥reconcileä¹‹åè¯»åˆ°çš„æ˜¯æ—§æ•°æ®çš„é—®é¢˜&lt;/h3>
&lt;p>è¯»åˆ°æ—§æ•°æ®æ˜¯å¦è¯´æ˜æ˜¯å…ˆå‡ºå‘reconcileå†æ›´æ–°local storeçš„&lt;/p>
&lt;p>My cache might be stale if I read from a cache! How should I deal with that?&lt;/p>
&lt;p>åœ¨æ›´æ–°æˆ–patch statusä¹‹åï¼Œé€šè¿‡wait.Pool(100ms, 2s, func()(bool, error))æ ¡éªŒcacheä¸­çš„æœ¬objectæ•°æ®ç›´è‡³æ›´æ–°&lt;/p>
&lt;p>&lt;a href="https://github.com/kubernetes-sigs/controller-runtime/blob/main/FAQ.md#q-my-cache-might-be-stale-if-i-read-from-a-cache-how-should-i-deal-with-that">https://github.com/kubernetes-sigs/controller-runtime/blob/main/FAQ.md#q-my-cache-might-be-stale-if-i-read-from-a-cache-how-should-i-deal-with-that&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/kubernetes/test-infra/blob/8f0f19a905a20ed6f76386e5e11343d4bc2446a7/prow/plank/reconciler.go#L516-L520">https://github.com/kubernetes/test-infra/blob/8f0f19a905a20ed6f76386e5e11343d4bc2446a7/prow/plank/reconciler.go#L516-L520&lt;/a>&lt;/p></description></item><item><title>Kubevirt Hook Sidecar</title><link>/posts/kubevirt-sidecar/</link><pubDate>Sun, 12 May 2024 14:37:18 +0800</pubDate><guid>/posts/kubevirt-sidecar/</guid><description>&lt;h2 id="ç®€ä»‹">ç®€ä»‹&lt;/h2>
&lt;h3 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h3>
&lt;blockquote>
&lt;p>åœ¨kubevirtä¸­, é€šè¿‡vmiçš„specæ²¡åŠæ³•æ¶µç›–æ‰€æœ‰çš„&lt;a href="https://libvirt.org/formatdomain.html">libvirt domain xml&lt;/a>å…ƒç´ , æ‰€ä»¥æœ‰äº†hook sidecaråŠŸèƒ½æ¥å…è®¸æˆ‘ä»¬åœ¨define domainä¹‹å‰è‡ªå®šä¹‰domainSpecXML&lt;/p>
&lt;/blockquote>
&lt;h3 id="åŠŸèƒ½ä»‹ç»">åŠŸèƒ½ä»‹ç»&lt;/h3>
&lt;p>åœ¨kubevirtä¸­, Hook Sidecarå®¹å™¨æ˜¯sidecar container(å’Œmain application containerè·‘åœ¨åŒä¸€ä¸ªpodä¸­)ç”¨æ¥åœ¨vmåˆå§‹åŒ–å®Œæˆå‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰æ“ä½œ.&lt;/p>
&lt;p>sidecar containerä¸main container(compute)é€šè¿‡gRPCé€šè®¯, æœ‰ä¸¤ç§ä¸»è¦çš„sidecar hooks&lt;/p>
&lt;ol>
&lt;li>&lt;code>OnDefineDomain&lt;/code>: è¿™ä¸ªhookå¸®åŠ©è‡ªå®šä¹‰libvirtçš„XML, å¹¶é€šè¿‡gRPCåè®®è¿”å›æœ€æ–°çš„XMLä»¥åˆ›å»ºvm&lt;/li>
&lt;li>&lt;code>PreCloudInitIso&lt;/code>: è¿™ä¸ªhookå¸®åŠ©å®šä¹‰cloud-inité…ç½®, å®ƒè¿è¡Œå¹¶è¿”å›æœ€æ–°çš„cloud-init data&lt;/li>
&lt;li>&lt;code>Shutdown&lt;/code>: è¿™ä¸ªæ˜¯&lt;code>v1alpha3&lt;/code>ç‰ˆæœ¬æ‰æ”¯æŒçš„&lt;/li>
&lt;/ol>
&lt;p>ä½¿ç”¨hook sidecaråŠŸèƒ½éœ€è¦åœ¨&lt;code>kv.spec.configuration.developerConfiguration.featureGates&lt;/code>ä¸­å¼€å¯&lt;code>Sidecar&lt;/code>åŠŸèƒ½&lt;/p>
&lt;h2 id="æºç åˆ†æ">æºç åˆ†æ&lt;/h2>
&lt;h3 id="kubevirt-boot-sidecar-ä»‹ç»">kubevirt-boot-sidecar ä»‹ç»&lt;/h3>
&lt;p>ä»¥ä¸‹ä»¥&lt;a href="https://github.com/go-bai/kubevirt-boot-sidecar">kubevirt-boot-sidecar&lt;/a>ä¸ºä¾‹è®²è¿°sidecarçš„å·¥ä½œæµç¨‹, è¿™ä¸ªsidecaræ”¯æŒä¿®æ”¹&lt;code>å¼•å¯¼è®¾å¤‡é¡ºåº(boot)&lt;/code>å’Œ&lt;code>å¼€å¯äº¤äº’å¼å¼•å¯¼èœå•(bootmenu)&lt;/code>&lt;/p>
&lt;p>&lt;code>kubevirt-boot-sidecar&lt;/code>åªå®ç°äº†&lt;code>OnDefineDomain&lt;/code>, ä¸‹é¢ä¹Ÿæ˜¯ä¸»è¦ä¸²ä¸€ä¸‹OnDefineDomainç›¸å…³çš„&lt;/p>
&lt;h3 id="sidecarå·¥ä½œæµç¨‹">sidecarå·¥ä½œæµç¨‹&lt;/h3>
&lt;ol>
&lt;li>&lt;code>virt-launcher&lt;/code>åˆšå¯åŠ¨æ—¶æ”¶é›†æ‰€æœ‰sidecarä¿¡æ¯
&lt;pre>&lt;code class="language-golang">// cmd/virt-launcher/virt-launcher.go
func main() {
 hookSidecars := pflag.Uint(&amp;quot;hook-sidecars&amp;quot;, 0, &amp;quot;Number of requested hook sidecars, virt-launcher will wait for all of them to become available&amp;quot;)
 // æ”¶é›†æ‰€æœ‰sidecarçš„ä¿¡æ¯
 err := hookManager.Collect(*hookSidecars, *qemuTimeout)

 // å¯åŠ¨ cmd server, è¿™é‡Œé¢æœ‰ SyncVirtualMachine æ–¹æ³•, å…·ä½“çš„å®ç°åœ¨ func (l *LibvirtDomainManager) SyncVMI
 // virt-handleråœ¨åˆå§‹åŒ–å®Œè™šæ‹Ÿæœºç¡¬ç›˜ç­‰ä¹‹åä¼šé€šè¿‡ SyncVirtualMachine è°ƒç”¨SyncVMIå‡½æ•°å¼€å§‹åˆ›å»ºdomain
 // SyncVMIå°†vmi specè½¬æ¢ä¸ºdomainSpec, ç„¶åè°ƒç”¨hooksManager.OnDefineDomainæ‰§è¡Œæ‰€æœ‰çš„sidecarçš„OnDefineDomainæ–¹æ³•
 // æœ€ç»ˆç”¨OnDefineDomainç¼–è¾‘åçš„domainSpecåˆ›å»ºdomain
 cmdServerDone := startCmdServer(cmdclient.UninitializedSocketOnGuest(), domainManager, stopChan, options)
}

// pkg/hooks/manager.go
// numberOfRequestedHookSidecarsä¸ºvmiæ³¨è§£ hooks.kubevirt.io/hookSidecars çš„æ•°ç»„é•¿åº¦, åœ¨virt-controllerç”Ÿæˆpod manifestçš„é€»è¾‘ä¸­è®¡ç®—å¾—å‡º
func (m *hookManager) Collect(numberOfRequestedHookSidecars uint, timeout time.Duration) error {
 // callbacksPerHookPoint
 callbacksPerHookPoint, err := m.collectSideCarSockets(numberOfRequestedHookSidecars, timeout)
 m.CallbacksPerHookPoint = callbacksPerHookPoint
}

// pkg/hooks/manager.go
func (m *hookManager) collectSideCarSockets(numberOfRequestedHookSidecars uint, timeout time.Duration) (map[string][]*callBackClient, error) {
 callbacksPerHookPoint := make(map[string][]*callBackClient)
 processedSockets := make(map[string]bool)
 timeoutCh := time.After(timeout)

 for uint(len(processedSockets)) &amp;lt; numberOfRequestedHookSidecars {
 sockets, err := os.ReadDir(m.hookSocketSharedDirectory)
 // éå† /var/run/kubevirt-hooks/ ç›®å½•ä¸‹çš„ unix socket æ–‡ä»¶
 for _, socket := range sockets {
 select {
 case &amp;lt;-timeoutCh:
 return nil, fmt.Errorf(&amp;quot;Failed to collect all expected sidecar hook sockets within given timeout&amp;quot;)
 default:
 if _, processed := processedSockets[socket.Name()]; processed {
 continue
 }

 // è¿æ¥ sock æ–‡ä»¶å¯¹åº”çš„ sidecar server çš„ Info å‡½æ•°è·å– server å®ç°äº†å“ªäº› hook(onDefineDomainæˆ–preCloudInitIso)
 callBackClient, notReady, err := processSideCarSocket(filepath.Join(m.hookSocketSharedDirectory, socket.Name()))
 if notReady {
 log.Log.Info(&amp;quot;Sidecar server might not be ready yet, retrying in the next iteration&amp;quot;)
 continue
 } else if err != nil {
 return nil, err
 }

 // callbacksPerHookPoint[onDefineDomain|preCloudInitIso][]*callBackClient{}
 // èšåˆå‡º onDefineDomain:[&amp;quot;aaaa.sock&amp;quot;,&amp;quot;bbbb.sock&amp;quot;]
 for _, subscribedHookPoint := range callBackClient.subscribedHookPoints {
 callbacksPerHookPoint[subscribedHookPoint.GetName()] = append(callbacksPerHookPoint[subscribedHookPoint.GetName()], callBackClient)
 }

 processedSockets[socket.Name()] = true
 }
 }
 time.Sleep(time.Second)
 }
 // {&amp;quot;onDefineDomain&amp;quot;:[{&amp;quot;SocketPath&amp;quot;:&amp;quot;/var/run/kubevirt-hooks/shim-xxxx.sock&amp;quot;, &amp;quot;Version&amp;quot;:&amp;quot;v1alpha3&amp;quot;, &amp;quot;subscribedHookPoints&amp;quot;: [{&amp;quot;name&amp;quot;: &amp;quot;onDefineDomain&amp;quot;, &amp;quot;priority&amp;quot;: 0}]}]}
 return callbacksPerHookPoint, nil
}
&lt;/code>&lt;/pr</description></item><item><title>æ— çº¿è½¬æœ‰çº¿ç½‘ç»œ</title><link>/posts/wireless-to-wired-network/</link><pubDate>Tue, 09 Apr 2024 22:16:24 +0800</pubDate><guid>/posts/wireless-to-wired-network/</guid><description>&lt;blockquote>
&lt;p>é€šè¿‡æ— çº¿ç½‘å¡è¿æ¥ç½‘ç»œ&lt;code>A(192.168.31.0/24)&lt;/code>, æ— çº¿ç½‘å¡ç›¸å½“äº&lt;code>WAN&lt;/code>å£ï¼Œé€šè¿‡æœ‰çº¿ç½‘å¡æ¥å…¥ç½‘ç»œ&lt;code>B(192.168.1.0/24)&lt;/code>, æœ‰çº¿ç½‘å¡ç›¸å½“äº&lt;code>LAN&lt;/code>å£&lt;/p>
&lt;/blockquote>
&lt;h2 id="å‡†å¤‡ä¸€ä¸ªubuntuè™šæ‹Ÿæœºrouter">å‡†å¤‡ä¸€ä¸ªubuntuè™šæ‹Ÿæœº&lt;code>router&lt;/code>&lt;/h2>
&lt;pre>&lt;code class="language-bash"># å‡†å¤‡qcow2åŸºç¡€é•œåƒ
wget https://down.idc.wiki/Image/realServer-Template/current/qcow2/ubuntu22.qcow2 -O /var/lib/libvirt/images/ubuntu.qcow2
# åˆ›å»ºè™šæ‹Ÿæœºä»¥åŸºç¡€é•œåƒä¸ºbacking fileçš„å¢é‡ç›˜
qemu-img create -f qcow2 -F qcow2 -b /var/lib/libvirt/images/ubuntu.qcow2 /var/lib/libvirt/disks/router.qcow2 20G
# åˆ›å»ºå¹¶å¯åŠ¨è™šæ‹Ÿæœº
virt-install --name router --memory 512 --vcpus 1 --disk /var/lib/libvirt/disks/router.qcow2,bus=sata --import --os-variant ubuntu22.10 --network bridge=br0 --noautoconsole
# è®¾ç½®è‡ªåŠ¨å¯åŠ¨
virsh autostart router
&lt;/code>&lt;/pre>
&lt;h2 id="é…ç½®ç½‘ç»œ">é…ç½®ç½‘ç»œ&lt;/h2>
&lt;h3 id="å°†æ— çº¿ç½‘å¡é€ä¼ è¿›è™šæ‹Ÿæœº">å°†æ— çº¿ç½‘å¡é€ä¼ è¿›è™šæ‹Ÿæœº&lt;/h3>
&lt;p>æ‰“å¼€ &lt;code>virt-manager&lt;/code> -&amp;gt; åŒå‡» &lt;code>router domain&lt;/code> -&amp;gt; ç‚¹å‡» &lt;code>Show virtual hardware details&lt;/code> -&amp;gt; ç‚¹å‡» &lt;code>Add Hardware&lt;/code> -&amp;gt; ç‚¹å‡» &lt;code>PCI Host Device&lt;/code> -&amp;gt; é€‰æ‹© &lt;code>Intel Corporation Wi-Fi 6 AX200&lt;/code> -&amp;gt; ç‚¹å‡» &lt;code>Finish&lt;/code>&lt;/p></description></item><item><title>Rclone</title><link>/posts/rclone/</link><pubDate>Thu, 04 Apr 2024 15:56:58 +0800</pubDate><guid>/posts/rclone/</guid><description>&lt;blockquote>
&lt;p>ä½¿ç”¨&lt;code>rclone&lt;/code>å’Œ&lt;code>alist&lt;/code>æä¾›çš„&lt;code>webdav&lt;/code>æ¥å£å°†é˜¿é‡Œäº‘ç›˜&lt;code>mount&lt;/code>åˆ°Ubuntu 22.04çš„ç›®å½•ä¸Š, å®ç°åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·è®¿é—®é˜¿é‡Œäº‘ç›˜å†…çš„æ–‡ä»¶&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä¸‹è½½å®‰è£…rclone">ä¸‹è½½å®‰è£…&lt;code>rclone&lt;/code>&lt;/h2>
&lt;pre>&lt;code class="language-bash">curl https://rclone.org/install.sh | bash
&lt;/code>&lt;/pre>
&lt;h2 id="é…ç½®rclone-config">é…ç½®&lt;code>rclone config&lt;/code>&lt;/h2>
&lt;pre>&lt;code class="language-bash"># rclone config
No remotes found, make a new one?
n) New remote
s) Set configuration password
q) Quit config
n/s/q&amp;gt; n

Enter name for new remote.
name&amp;gt; alist

Option Storage.
Type of storage to configure.
Choose a number from below, or type in your own value.
 1 / 1Fichier
 \ (fichier)
...
51 / WebDAV
 \ (webdav)
...
Storage&amp;gt; 51

Option url.
URL of http host to connect to.
E.g. https://example.com.
Enter a value.
url&amp;gt; http://alist.home.lan/dav/

Option vendor.
Name of the WebDAV site/service/software you are using.
Choose a number from below, or type in your own value.
Press Enter to leave empty.
 1 / Fastmail Files
 \ (fastmail)
 2 / Nextcloud
 \ (nextcloud)
 3 / Owncloud
 \ (owncloud)
 4 / Sharepoint Online, authenticated by Microsoft account
 \ (sharepoint)
 5 / Sharepoint with NTLM authentication, usually self-hosted or on-premises
 \ (sharepoint-ntlm)
 6 / rclone WebDAV server to serve a remote over HTTP via the WebDAV protocol
 \ (rclone)
 7 / Other site/service or software
 \ (other)
vendor&amp;gt; 7

Option user.
User name.
In case NTLM authentication is used, the username should be in the format 'Domain\User'.
Enter a value. Press Enter to leave empty.
user&amp;gt; admin

Option pass.
Password.
Choose an alternative below. Press Enter for the default (n).
y) Yes, type in my own password
g) Generate random password
n) No, leave this optional password blank (default)
y/g/n&amp;gt; y
Enter the password:
password:
Confirm the password:
password:

Option bearer_token.
Bearer token instead of user/pass (e.g. a Macaroon).
Enter a value. Press Enter to leave empty.
bearer_token&amp;gt;

Edit advanced config?
y) Yes
n) No (default)
y/n&amp;gt; n

Configuration complete.
Options:
- type: webdav
- url: http://alist.home.lan/dav/
- vendor: other
- user: admin
- pass: *** ENCRYPTED ***
Keep this &amp;quot;alist&amp;quot; remote?
y) Yes this is OK (default)
e) Edit this remote
d) Delete this remote
y/e/d&amp;gt; y

Current remotes:

Name Type
==== ====
alist webdav

e) Edit existing remote
n) New remote
d) Delete remote
r) Rename remote
c) Copy remote
s) Set configuration password
q) Quit config
e/n/d/r/c/s/q&amp;gt; q
&lt;/code>&lt;/pr</description></item><item><title>Multi-Bootable USB</title><link>/posts/multi-bootable-usb/</link><pubDate>Thu, 28 Mar 2024 22:20:22 +0800</pubDate><guid>/posts/multi-bootable-usb/</guid><description>&lt;blockquote>
&lt;p>ä»ä¸€ä¸ªUSBè®¾å¤‡(Uç›˜)å¯åŠ¨å¤šä¸ªæ“ä½œç³»ç»Ÿ, å¹¶ä¸”Uç›˜è¿˜èƒ½ç»§ç»­å­˜å‚¨å…¶ä»–æ™®é€šæ–‡ä»¶&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä¸‹è½½å¹¶è§£å‹ventoy">ä¸‹è½½å¹¶è§£å‹&lt;code>ventoy&lt;/code>&lt;/h2>
&lt;pre>&lt;code class="language-bash">wget https://github.com/ventoy/Ventoy/releases/download/v1.0.97/ventoy-1.0.97-linux.tar.gz
tar -xvzf ventoy-1.0.97-linux.tar.gz
cd ventoy-1.0.97/
&lt;/code>&lt;/pre>
&lt;p>&lt;code>Ventoy2Disk.sh&lt;/code>ç”¨æ¥å®‰è£…&lt;code>ventor&lt;/code>åˆ°Uç›˜&lt;/p>
&lt;pre>&lt;code class="language-bash">./Ventoy2Disk.sh -h

**********************************************
 Ventoy: 1.0.97 x86_64
 longpanda admin@ventoy.net
 https://www.ventoy.net
**********************************************

Usage: Ventoy2Disk.sh CMD [ OPTION ] /dev/sdX
 CMD:
 -i install Ventoy to sdX (fails if disk already installed with Ventoy)
 -I force install Ventoy to sdX (no matter if installed or not)
 -u update Ventoy in sdX
 -l list Ventoy information in sdX

 OPTION: (optional)
 -r SIZE_MB preserve some space at the bottom of the disk (only for install)
 -s/-S enable/disable secure boot support (default is enabled)
 -g use GPT partition style, default is MBR (only for install)
 -L Label of the 1st exfat partition (default is Ventoy)
 -n try non-destructive installation (only for install)
&lt;/code>&lt;/pr</description></item><item><title>Shell Script</title><link>/posts/shell-script/</link><pubDate>Sat, 23 Mar 2024 09:43:34 +0800</pubDate><guid>/posts/shell-script/</guid><description>&lt;blockquote>
&lt;p>æœ€è¿‘å†™çš„shellè„šæœ¬æ¯”è¾ƒå¤šï¼Œè®°å½•ä¸€äº›å¸¸ç”¨å‘½ä»¤, ç›¸å½“äºè®°å½•ä¸€ä¸ªç´¢å¼•, ä»¥åç”¨æ—¶å¯ä»¥å¿«é€Ÿå›å¿†èµ·æ¥.&lt;/p>
&lt;/blockquote>
&lt;h2 id="binbash">&lt;code>#!/bin/bash&lt;/code>&lt;/h2>
&lt;p>&lt;code>#!/bin/bash&lt;/code>è¢«ç§°ä¸º&lt;code>shebang line&lt;/code>, æŒ‡å®šæ‰§è¡Œæ­¤è„šæœ¬æ–‡ä»¶æ—¶ä½¿ç”¨&lt;code>/bin/bash&lt;/code>åšä¸ºshellè§£é‡Šå™¨ç¨‹åº&lt;/p>
&lt;p>å¾ˆå¤šä¸»æµæ“ä½œç³»ç»Ÿé»˜è®¤çš„shellè§£é‡Šå™¨ä¹Ÿæ˜¯bash&lt;/p>
&lt;pre>&lt;code class="language-bash"># echo $SHELL
/bin/bash
&lt;/code>&lt;/pre>
&lt;h2 id="set">&lt;code>set&lt;/code>&lt;/h2>
&lt;p>&lt;code>set&lt;/code>å‘½ä»¤ç”¨æ¥ä¿®æ”¹shellç¯å¢ƒçš„è¿è¡Œå‚æ•°, å®Œæ•´çš„å¯å®šåˆ¶çš„&lt;a href="https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html">å®˜æ–¹æ‰‹å†Œ&lt;/a>&lt;/p>
&lt;p>ä¸‹é¢æ˜¯æˆ‘å¸¸ç”¨çš„å‡ ä¸ª, å¯ä»¥åˆå¹¶ä¸ºå¦‚ä¸‹å†…å®¹å†™åœ¨è„šæœ¬å¼€å¤´:&lt;/p>
&lt;pre>&lt;code class="language-bash">#!/bin/bash
set -uxe
set -o pipefail
&lt;/code>&lt;/pre>
&lt;h3 id="set--u">&lt;code>set -u&lt;/code>&lt;/h3>
&lt;p>æ‰§è¡Œè„šæœ¬æ—¶, å¦‚æœé‡åˆ°ä¸å­˜åœ¨çš„å˜é‡, Bashé»˜è®¤ä¼šå¿½ç•¥, &lt;code>set -u&lt;/code>å¯ä»¥è®©è„šæœ¬è¯»åˆ°ä¸å­˜åœ¨å˜é‡æ—¶æŠ¥é”™&lt;/p>
&lt;h3 id="set--x">&lt;code>set -x&lt;/code>&lt;/h3>
&lt;p>å‘½ä»¤æ‰§è¡Œå‰ä¼šå…ˆæ‰“å°å‡ºæ¥, è¡Œé¦–ä»¥&lt;code>+&lt;/code>è¡¨ç¤º, åœ¨è°ƒè¯•è„šæœ¬æ—¶éå¸¸æœ‰å¸®åŠ©&lt;/p>
&lt;h3 id="set--e">&lt;code>set -e&lt;/code>&lt;/h3>
&lt;p>æ‰§è¡Œè„šæœ¬æ—¶, Bashé‡åˆ°é”™è¯¯é»˜è®¤ä¼šç»§ç»­æ‰§è¡Œ, &lt;code>set -e&lt;/code>ä½¿å¾—è„šæœ¬åªè¦å‘ç”Ÿé”™è¯¯, å°±ä¸­æ­¢æ‰§è¡Œ&lt;/p>
&lt;h3 id="set--o-pipefail">&lt;code>set -o pipefail&lt;/code>&lt;/h3>
&lt;p>&lt;code>set -e&lt;/code>æœ‰ä¸€ä¸ªä¾‹å¤–æƒ…å†µ, å°±æ˜¯ä¸é€‚ç”¨äºç®¡é“å‘½ä»¤, æ¯”å¦‚ä¸‹é¢çš„ä¸ä¼šé€€å‡º&lt;/p></description></item><item><title>sqlx vs xorm</title><link>/posts/sqlx-vs-xorm/</link><pubDate>Sat, 09 Mar 2024 10:49:09 +0800</pubDate><guid>/posts/sqlx-vs-xorm/</guid><description>&lt;h2 id="åˆå§‹åŒ–æ¼”ç¤ºç¯å¢ƒ">åˆå§‹åŒ–æ¼”ç¤ºç¯å¢ƒ&lt;/h2>
&lt;h3 id="ä½¿ç”¨dockeréƒ¨ç½²">ä½¿ç”¨dockeréƒ¨ç½²&lt;/h3>
&lt;p>éƒ¨ç½²çš„å½“å‰æ—¶é—´æœ€æ–°ç‰ˆæœ¬&lt;code>postgres:16.2&lt;/code>&lt;/p>
&lt;pre>&lt;code class="language-bash">docker run -d --name pgsql \
 -e POSTGRES_USER=admin \
 -e POSTGRES_PASSWORD=passwd \
 -e POSTGRES_DB=testdb \
 -p 15432:5432 \
 postgres:16.2
&lt;/code>&lt;/pre>
&lt;h3 id="ä½¿ç”¨psqlè¿æ¥">ä½¿ç”¨&lt;code>psql&lt;/code>è¿æ¥&lt;/h3>
&lt;pre>&lt;code class="language-bash">docker exec -it pgsql psql -U admin -d testdb
&lt;/code>&lt;/pre>
&lt;h3 id="åˆå§‹åŒ–uservpså’Œhostè¡¨">åˆå§‹åŒ–&lt;code>user&lt;/code>,&lt;code>vps&lt;/code>å’Œ&lt;code>host&lt;/code>è¡¨&lt;/h3>
&lt;pre>&lt;code class="language-sql">CREATE TABLE &amp;quot;user&amp;quot; (
 id bigserial PRIMARY KEY,
 username VARCHAR(255) NOT NULL,
 password VARCHAR(255) NOT NULL
);
CREATE TABLE &amp;quot;host&amp;quot; (
 id bigserial PRIMARY KEY,
 hostname VARCHAR(255) NOT NULL
);
CREATE TABLE &amp;quot;vps&amp;quot; (
 id bigserial PRIMARY KEY,
 user_id bigint NOT NULL,
 host_id bigint NOT NULL,
 name VARCHAR(255) NOT NULL,
 sys_disk jsonb NOT NULL DEFAULT '{}'
);
&lt;/code>&lt;/pr</description></item><item><title>OpenWrt</title><link>/posts/openwrt/</link><pubDate>Sat, 06 Jan 2024 17:38:38 +0800</pubDate><guid>/posts/openwrt/</guid><description>&lt;p>å¾ˆä¹…æ²¡æŠ˜è…¾&lt;code>OpenWrt&lt;/code>äº†, å›Šä¸­ç¾æ¶©, æ²¡æœ‰å…¶ä»–åˆé€‚çš„è®¾å¤‡, è¿™æ¬¡æ˜¯åœ¨KVMè™šæœºä¸­è¿è¡Œä½¿ç”¨(&lt;code>ALL IN BOOM!&lt;/code>)&lt;/p>
&lt;p>å…ˆäº®ä¸ªå½“å‰çš„ç©·äººç‰ˆå®¶åº­ç½‘ç»œæ‹“æ‰‘å›¾&lt;/p>
&lt;p>&lt;img src="/posts/linux/imgs/home-network-topology-diagram.svg" alt="ç©·äººç‰ˆå®¶åº­ç½‘ç»œæ‹“æ‰‘å›¾">&lt;/p>
&lt;h2 id="å‡†å¤‡qcow2é•œåƒ">å‡†å¤‡&lt;code>qcow2&lt;/code>é•œåƒ&lt;/h2>
&lt;p>é¦–å…ˆä¸‹è½½æœ€æ–°çš„&lt;a href="https://downloads.openwrt.org/releases">é•œåƒ&lt;/a>, æˆªæ­¢ç›®å‰æœ€æ–°ç‰ˆä¸º&lt;code>23.05.3&lt;/code>, æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯x86-64çš„é•œåƒ&lt;/p>
&lt;pre>&lt;code class="language-bash">wget https://mirror-03.infra.openwrt.org/releases/23.05.3/targets/x86/64/openwrt-23.05.3-x86-64-generic-ext4-combined.img.gz
# è§£å‹
gunzip openwrt-23.05.3-x86-64-generic-ext4-combined.img.gz
# è¿™é‡Œå› ä¸ºæˆ‘è¦ä½œä¸ºKVMè™šæ‹Ÿæœºçš„é•œåƒ, æ‰€ä»¥è½¬æ¢ä¸ºqcow2æ ¼å¼. å¦‚æœæ˜¯åœ¨ç‰©ç†æœºä¸Šéƒ¨ç½², å¯ä»¥ç›´æ¥ç›´æ¥åˆ·åˆ°Uç›˜ä¸Š.
qemu-img convert -f raw openwrt-23.05.3-x86-64-generic-ext4-combined.img -O qcow2 /var/lib/libvirt/images/openwrt.qcow2
&lt;/code>&lt;/pre>
&lt;h2 id="è¿è¡Œè™šæœº">è¿è¡Œè™šæœº&lt;/h2>
&lt;p>æˆ‘æ˜¯ç”¨&lt;code>libvirt&lt;/code>æ¥ç®¡ç†qemu/kvmè™šæ‹Ÿæœº, å¦‚æœæ²¡å®‰è£…è¦å…ˆå®‰è£…&lt;/p>
&lt;pre>&lt;code class="language-bash">apt install virt-manager qemu bridge-utils -y
&lt;/code>&lt;/pre>
&lt;p>æˆ‘è¿™é‡Œå°†é•œåƒå¤åˆ¶åˆ°äº†&lt;code>/var/lib/libvirt/disks/&lt;/code>ç›®å½•ä¸‹&lt;/p>
&lt;pre>&lt;code class="language-bash">qemu-img create -f qcow2 -F qcow2 -b /var/lib/libvirt/images/openwrt.qcow2 /var/lib/libvirt/disks/openwrt.qcow2 1G
&lt;/code>&lt;/pr</description></item><item><title>dhclient</title><link>/posts/dhclient/</link><pubDate>Mon, 09 Oct 2023 21:37:55 +0800</pubDate><guid>/posts/dhclient/</guid><description>&lt;p>åœ¨æœºå™¨ä¸Šä½¿ç”¨&lt;code>netplan&lt;/code>+&lt;code>NetworkManager&lt;/code>é…ç½®&lt;a href="../creating-a-bridged-network-with-netplan-on-ubuntu-22-04">bridged network&lt;/a>ä¹‹å&lt;/p>
&lt;p>æœ€è¿‘ç»å¸¸ç”µè„‘ç”¨ç€ç”¨ç€å°±ä¸èƒ½è”ç½‘äº†ï¼Œå‘ç°&lt;code>enp1s0&lt;/code>æ€»æ˜¯å¶å°”å†’å‡ºä¸€ä¸ª&lt;code>ipv4&lt;/code>åœ°å€ï¼Œå¹¶ä¸”è·¯ç”±è¡¨ä¼šå¤šå‡ºä¸€ä¸ªä»&lt;code>enp1s0&lt;/code>å‡ºå»çš„&lt;code>default&lt;/code>è·¯ç”±ã€‚åæ¥çœ‹&lt;code>journalctl&lt;/code>æ—¥å¿—å‘ç°æ˜¯&lt;code>dhclient&lt;/code>æçš„äº‹æƒ…(å­¦è‰ºä¸ç²¾, æ²¡ç¬¬ä¸€æ—¶é—´è”ç³»èµ·æ¥)ã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯éƒ¨åˆ†æ—¥å¿—ï¼š&lt;/p>
&lt;pre>&lt;code class="language-bash">âœ ~ journalctl -n 1000000 | grep '192.168.1.22\|enp1s0'
...
10æœˆ 09 20:14:25 gobai-SER dhclient[107299]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x4745a8ce)
10æœˆ 09 20:14:26 gobai-SER dhclient[73666]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x2cfc74b3)
10æœˆ 09 20:14:26 gobai-SER dhclient[157839]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x453b8549)
10æœˆ 09 20:14:28 gobai-SER dhclient[170251]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x334a15e8)
10æœˆ 09 20:14:28 gobai-SER dhclient[237127]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x7fd24947)
10æœˆ 09 20:14:32 gobai-SER avahi-autoipd(enp1s0)[307826]: Found user 'avahi-autoipd' (UID 110) and group 'avahi-autoipd' (GID 119).
10æœˆ 09 20:14:32 gobai-SER avahi-autoipd(enp1s0)[307826]: Successfully called chroot().
10æœˆ 09 20:14:32 gobai-SER avahi-autoipd(enp1s0)[307826]: Successfully dropped root privileges.
10æœˆ 09 20:14:32 gobai-SER avahi-autoipd(enp1s0)[307826]: Starting with address 169.254.4.220
10æœˆ 09 20:14:32 gobai-SER avahi-autoipd(enp1s0)[307826]: Got SIGTERM, quitting.
10æœˆ 09 20:14:32 gobai-SER dhclient[170251]: DHCPDISCOVER on enp1s0 to 255.255.255.255 port 67 interval 3 (xid=0x1f69d35f)
10æœˆ 09 20:14:32 gobai-SER dhclient[170251]: DHCPOFFER of 192.168.1.22 from 192.168.1.1
10æœˆ 09 20:14:32 gobai-SER dhclient[170251]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x5fd3691f)
10æœˆ 09 20:14:32 gobai-SER dhclient[170251]: DHCPACK of 192.168.1.22 from 192.168.1.1 (xid=0x1f69d35f)
10æœˆ 09 20:14:32 gobai-SER avahi-daemon[588]: Joining mDNS multicast group on interface enp1s0.IPv4 with address 192.168.1.22.
10æœˆ 09 20:14:32 gobai-SER avahi-daemon[588]: New relevant interface enp1s0.IPv4 for mDNS.
10æœˆ 09 20:14:32 gobai-SER avahi-daemon[588]: Registering new address record for 192.168.1.22 on enp1s0.IPv4.
10æœˆ 09 20:14:32 gobai-SER systemd-resolved[237121]: enp1s0: Bus client set search domain list to: home
10æœˆ 09 20:14:32 gobai-SER dhclient[157839]: DHCPDISCOVER on enp1s0 to 255.255.255.255 port 67 interval 3 (xid=0x41cc913f)
10æœˆ 09 20:14:32 gobai-SER systemd-resolved[237121]: enp1s0: Bus client set DNS server list to: 192.168.1.1, 223.5.5.5
10æœˆ 09 20:14:32 gobai-SER dhclient[157839]: DHCPOFFER of 192.168.1.22 from 192.168.1.1
10æœˆ 09 20:14:32 gobai-SER dhclient[157839]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x3f91cc41)
10æœˆ 09 20:14:32 gobai-SER dhclient[157839]: DHCPACK of 192.168.1.22 from 192.168.1.1 (xid=0x41cc913f)
10æœˆ 09 20:14:32 gobai-SER dhclient[170251]: bound to 192.168.1.22 -- renewal in 32921 seconds.
10æœˆ 09 20:14:32 gobai-SER dhclient[157839]: bound to 192.168.1.22 -- renewal in 36989 seconds.
10æœˆ 09 20:14:35 gobai-SER avahi-daemon[588]: Withdrawing address record for 192.168.1.22 on enp1s0.
10æœˆ 09 20:14:35 gobai-SER avahi-daemon[588]: Leaving mDNS multicast group on interface enp1s0.IPv4 with address 192.168.1.22.
10æœˆ 09 20:14:35 gobai-SER avahi-daemon[588]: Interface enp1s0.IPv4 no longer relevant for mDNS.
10æœˆ 09 20:14:35 gobai-SER avahi-autoipd(enp1s0)[307982]: Found user 'avahi-autoipd' (UID 110) and group 'avahi-autoipd' (GID 119).
10æœˆ 09 20:14:35 gobai-SER avahi-autoipd(enp1s0)[307982]: Successfully called chroot().
10æœˆ 09 20:14:35 gobai-SER avahi-autoipd(enp1s0)[307982]: Successfully dropped root privileges.
10æœˆ 09 20:14:35 gobai-SER avahi-autoipd(enp1s0)[307982]: Starting with address 169.254.4.220
10æœˆ 09 20:14:35 gobai-SER avahi-autoipd(enp1s0)[307982]: Got SIGTERM, quitting.
10æœˆ 09 20:14:36 gobai-SER dhclient[73666]: DHCPDISCOVER on enp1s0 to 255.255.255.255 port 67 interval 3 (xid=0x50a89e0e)
10æœˆ 09 20:14:36 gobai-SER dhclient[73666]: DHCPOFFER of 192.168.1.22 from 192.168.1.1
10æœˆ 09 20:14:36 gobai-SER dhclient[73666]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0xe9ea850)
10æœˆ 09 20:14:36 gobai-SER dhclient[73666]: DHCPACK of 192.168.1.22 from 192.168.1.1 (xid=0x50a89e0e)
10æœˆ 09 20:14:36 gobai-SER avahi-daemon[588]: Joining mDNS multicast group on interface enp1s0.IPv4 with address 192.168.1.22.
10æœˆ 09 20:14:36 gobai-SER avahi-daemon[588]: New relevant interface enp1s0.IPv4 for mDNS.
10æœˆ 09 20:14:36 gobai-SER avahi-daemon[588]: Registering new address record for 192.168.1.22 on enp1s0.IPv4.
10æœˆ 09 20:14:36 gobai-SER systemd-resolved[237121]: enp1s0: Bus client set search domain list to: home
10æœˆ 09 20:14:36 gobai-SER systemd-resolved[237121]: enp1s0: Bus client set DNS server list to: 192.168.1.1, 223.5.5.5
10æœˆ 09 20:14:36 gobai-SER dhclient[73666]: bound to 192.168.1.22 -- renewal in 34351 seconds.
10æœˆ 09 20:14:36 gobai-SER dhclient[107299]: DHCPDISCOVER on enp1s0 to 255.255.255.255 port 67 interval 3 (xid=0x27725347)
10æœˆ 09 20:14:36 gobai-SER dhclient[107299]: DHCPOFFER of 192.168.1.22 from 192.168.1.1
10æœˆ 09 20:14:36 gobai-SER dhclient[107299]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x47537227)
10æœˆ 09 20:14:36 gobai-SER dhclient[107299]: DHCPACK of 192.168.1.22 from 192.168.1.1 (xid=0x27725347)
10æœˆ 09 20:14:36 gobai-SER dhclient[107299]: bound to 192.168.1.22 -- renewal in 40122 seconds.
10æœˆ 09 20:14:36 gobai-SER avahi-daemon[588]: Withdrawing address record for 192.168.1.22 on enp1s0.
10æœˆ 09 20:14:36 gobai-SER avahi-daemon[588]: Leaving mDNS multicast group on interface enp1s0.IPv4 with address 192.168.1.22.
10æœˆ 09 20:14:36 gobai-SER avahi-daemon[588]: Interface enp1s0.IPv4 no longer relevant for mDNS.
10æœˆ 09 20:14:36 gobai-SER avahi-autoipd(enp1s0)[308110]: Found user 'avahi-autoipd' (UID 110) and group 'avahi-autoipd' (GID 119).
10æœˆ 09 20:14:36 gobai-SER avahi-autoipd(enp1s0)[308110]: Successfully called chroot().
10æœˆ 09 20:14:36 gobai-SER avahi-autoipd(enp1s0)[308110]: Successfully dropped root privileges.
10æœˆ 09 20:14:36 gobai-SER avahi-autoipd(enp1s0)[308110]: Starting with address 169.254.4.220
10æœˆ 09 20:14:42 gobai-SER avahi-autoipd(enp1s0)[308110]: Callout BIND, address 169.254.4.220 on interface enp1s0
10æœˆ 09 20:14:42 gobai-SER avahi-daemon[588]: Joining mDNS multicast group on interface enp1s0.IPv4 with address 169.254.4.220.
10æœˆ 09 20:14:42 gobai-SER avahi-daemon[588]: New relevant interface enp1s0.IPv4 for mDNS.
10æœˆ 09 20:14:42 gobai-SER avahi-daemon[588]: Registering new address record for 169.254.4.220 on enp1s0.IPv4.
10æœˆ 09 20:14:46 gobai-SER avahi-autoipd(enp1s0)[308110]: Successfully claimed IP address 169.254.4.220
10æœˆ 09 20:14:46 gobai-SER avahi-autoipd(enp1s0)[308110]: Got SIGTERM, quitting.
10æœˆ 09 20:14:46 gobai-SER avahi-autoipd(enp1s0)[308110]: Callout STOP, address 169.254.4.220 on interface enp1s0
10æœˆ 09 20:14:46 gobai-SER avahi-daemon[588]: Withdrawing address record for 169.254.4.220 on enp1s0.
10æœˆ 09 20:14:46 gobai-SER avahi-daemon[588]: Leaving mDNS multicast group on interface enp1s0.IPv4 with address 169.254.4.220.
10æœˆ 09 20:14:46 gobai-SER avahi-daemon[588]: Interface enp1s0.IPv4 no longer relevant for mDNS.
10æœˆ 09 20:14:46 gobai-SER dhclient[237127]: DHCPDISCOVER on enp1s0 to 255.255.255.255 port 67 interval 3 (xid=0x389e944d)
10æœˆ 09 20:14:46 gobai-SER dhclient[237127]: DHCPOFFER of 192.168.1.22 from 192.168.1.1
10æœˆ 09 20:14:46 gobai-SER dhclient[237127]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x4d949e38)
10æœˆ 09 20:14:46 gobai-SER dhclient[237127]: DHCPACK of 192.168.1.22 from 192.168.1.1 (xid=0x389e944d)
10æœˆ 09 20:14:46 gobai-SER avahi-daemon[588]: Joining mDNS multicast group on interface enp1s0.IPv4 with address 192.168.1.22.
10æœˆ 09 20:14:46 gobai-SER avahi-daemon[588]: New relevant interface enp1s0.IPv4 for mDNS.
10æœˆ 09 20:14:46 gobai-SER avahi-daemon[588]: Registering new address record for 192.168.1.22 on enp1s0.IPv4.
10æœˆ 09 20:14:47 gobai-SER systemd-resolved[237121]: enp1s0: Bus client set search domain list to: home
10æœˆ 09 20:14:47 gobai-SER systemd-resolved[237121]: enp1s0: Bus client set DNS server list to: 192.168.1.1, 223.5.5.5
10æœˆ 09 20:14:47 gobai-SER dhclient[237127]: bound to 192.168.1.22 -- renewal in 40782 seconds.

âœ ~ ps -aux | grep dhclient
root 73666 0.0 0.0 101232 6228 ? Ssl 9æœˆ28 0:15 dhclient
root 107299 0.0 0.0 101232 6228 ? Ssl 10æœˆ04 0:09 dhclient
root 157839 0.0 0.0 101232 6112 ? Ssl 10æœˆ06 0:06 dhclient
root 170251 0.0 0.0 101232 6184 ? Ssl 10æœˆ06 0:08 dhclient
root 237127 0.0 0.0 101232 6012 ? Ssl 10æœˆ07 0:06 dhclient
gobai 322905 0.0 0.0 12308 2816 pts/5 S+ 21:49 0:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox dhclient
&lt;/code>&lt;/pr</description></item><item><title>Creating a bridged network with netplan on Ubuntu 22.04</title><link>/posts/creating-a-bridged-network-with-netplan-on-ubuntu-22-04/</link><pubDate>Wed, 04 Oct 2023 13:01:59 +0800</pubDate><guid>/posts/creating-a-bridged-network-with-netplan-on-ubuntu-22-04/</guid><description>&lt;p>æœ¬åœ°LANç¯å¢ƒ&lt;/p>
&lt;ol>
&lt;li>LANç½‘å…³ &lt;code>192.168.1.1&lt;/code>&lt;/li>
&lt;li>å­ç½‘æ©ç  &lt;code>255.255.255.0&lt;/code>&lt;/li>
&lt;li>DHCPèŒƒå›´ &lt;code>192.168.1.2&lt;/code>-&lt;code>192.168.32&lt;/code>&lt;/li>
&lt;/ol>
&lt;h2 id="åˆ›å»ºä¸€ä¸ªbridged-network">åˆ›å»ºä¸€ä¸ª&lt;code>bridged network&lt;/code>&lt;/h2>
&lt;p>åˆ›å»ºä¸€ä¸ªç½‘æ¡¥&lt;code>br0&lt;/code>ç»™è™šæœºä½¿ç”¨ï¼Œä½¿å¾—è™šæœºå’Œå…¶ä»–è®¾å¤‡éƒ½åœ¨ä¸€ä¸ªLANä¸‹&lt;/p>
&lt;p>æ€»é…ç½®(&lt;code>netplan get&lt;/code>)å¦‚ä¸‹:&lt;/p>
&lt;pre>&lt;code class="language-yaml">network:
 version: 2
 renderer: NetworkManager
 ethernets:
 enp1s0:
 dhcp4: false
 dhcp6: false
 bridges:
 br0:
 addresses:
 - &amp;quot;192.168.1.100/24&amp;quot;
 nameservers:
 addresses:
 - 192.168.1.1
 dhcp4: false
 dhcp6: false
 interfaces:
 - enp1s0
 parameters:
 stp: false
 routes:
 - to: &amp;quot;default&amp;quot;
 via: &amp;quot;192.168.1.1&amp;quot;
&lt;/code>&lt;/pr</description></item><item><title>åˆ é™¤åˆ†åŒºå¹¶æ‰©å®¹å¦ä¸€ä¸ªåˆ†åŒºå’Œæ ¹æ–‡ä»¶ç³»ç»Ÿ</title><link>/posts/delete-partition-and-expand-another/</link><pubDate>Mon, 02 Oct 2023 16:54:05 +0800</pubDate><guid>/posts/delete-partition-and-expand-another/</guid><description>&lt;blockquote>
&lt;p>ç°åœ¨è¦å°† &lt;code>/dev/sda3&lt;/code> åˆ†åŒºåˆ æ‰å¹¶æ‰©å®¹åˆ° &lt;code>/dev/sda2&lt;/code>, å¹¶ä¸”åœ¨ä¸é‡å¯æœåŠ¡å™¨çš„æƒ…å†µä¸‹æ‰©å®¹æ ¹æ–‡ä»¶ç³»ç»Ÿ(è·Ÿæ–‡ä»¶ç³»ç»Ÿ &lt;code>/&lt;/code> æŒ‚è½½åœ¨ &lt;code>/dev/sda2&lt;/code> ä¸Š, å¹¶ä¸” filesystem æ˜¯ &lt;code>ext4&lt;/code>)&lt;/p>
&lt;/blockquote>
&lt;h2 id="ç£ç›˜åˆå§‹åˆ†åŒºå’ŒæŒ‚è½½æƒ…å†µ">ç£ç›˜åˆå§‹åˆ†åŒºå’ŒæŒ‚è½½æƒ…å†µ&lt;/h2>
&lt;pre>&lt;code class="language-bash">âœ ~ lsblk /dev/sda
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sda 8:0 0 100G 0 disk 
â”œâ”€sda1 8:1 0 512M 0 part /boot/efi
â”œâ”€sda2 8:2 0 98.5G 0 part /
â””â”€sda3 8:3 0 976M 0 part 

âœ ~ fdisk -l /dev/sda
Disk /dev/sda: 100 GiB, 107374182400 bytes, 209715200 sectors
Disk model: BlockVolume 
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 1048576 bytes
Disklabel type: gpt
Disk identifier: 40BED670-8B91-4520-9785-DB1F1035C039

Device Start End Sectors Size Type
/dev/sda1 2048 1050623 1048576 512M EFI System
/dev/sda2 1050624 207714303 206663680 98.5G Linux filesystem
/dev/sda3 207714304 209713151 1998848 976M Linux swap

âœ ~ df -hT /dev/sda2
Filesystem Type Size Used Avail Use% Mounted on
/dev/sda2 ext4 97G 28G 64G 31% /
&lt;/code>&lt;/pr</description></item><item><title>Vscode Extensions</title><link>/posts/vscode-extensions/</link><pubDate>Mon, 25 Sep 2023 21:27:06 +0800</pubDate><guid>/posts/vscode-extensions/</guid><description>&lt;h2 id="è®°å½•æˆ‘çš„vscodeä½¿ç”¨çš„æ‰©å±•æ’ä»¶">è®°å½•æˆ‘çš„vscodeä½¿ç”¨çš„æ‰©å±•æ’ä»¶&lt;/h2>
&lt;p>æŒç»­è¡¥å……ä¸­&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://marketplace.visualstudio.com/items?itemName=wayou.vscode-icons-mac">vscode-icons-mac&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens">GitLens&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://marketplace.visualstudio.com/items?itemName=golang.go">Go&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh">Remote - SSH&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://marketplace.visualstudio.com/items?itemName=Remisa.shellman">shellman&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://marketplace.visualstudio.com/items?itemName=humao.rest-client">REST Client&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://marketplace.visualstudio.com/items?itemName=Gruntfuggly.todo-tree">Todo Tree&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸€äº›é…ç½®">ä¸€äº›é…ç½®&lt;/h2>
&lt;pre>&lt;code class="language-json">&amp;quot;workbench.tree.indent&amp;quot;: 16
&lt;/code>&lt;/pre></description></item><item><title>MacOS Config</title><link>/posts/macos-config/</link><pubDate>Sun, 24 Sep 2023 10:56:13 +0800</pubDate><guid>/posts/macos-config/</guid><description>&lt;h2 id="å®‰è£…iproute2mac">å®‰è£…&lt;code>iproute2mac&lt;/code>&lt;/h2>
&lt;p>å¯ä»¥å’Œåœ¨linuxæ“ä½œç³»ç»Ÿä¸€æ ·ä½¿ç”¨&lt;code>ip&lt;/code>å‘½ä»¤æŸ¥çœ‹å’Œç®¡ç†ç½‘ç»œ, èµ!!!&lt;/p>
&lt;pre>&lt;code class="language-bash">brew install iproute2mac
&lt;/code>&lt;/pre>
&lt;h2 id="sshé…ç½®alive">sshé…ç½®alive&lt;/h2>
&lt;p>é…ç½®&lt;code>ServerAliveInterval&lt;/code>, é˜²æ­¢é•¿æ—¶é—´æ²¡æœ‰æ•°æ®äº¤äº’åè¿æ¥æ–­æ‰&lt;/p>
&lt;pre>&lt;code class="language-bash"># cat ~/.ssh/config
Host *
 ServerAliveInterval 30

Host home
 HostName 192.168.1.100
 User root
...
&lt;/code>&lt;/pre></description></item><item><title>Ubuntu Config</title><link>/posts/ubuntu-config/</link><pubDate>Sun, 24 Sep 2023 10:56:12 +0800</pubDate><guid>/posts/ubuntu-config/</guid><description>&lt;blockquote>
&lt;p>ä»¥ä¸‹é…ç½®éƒ½æ˜¯åœ¨ &lt;code>Ubuntu 22.04&lt;/code> ç³»ç»Ÿé…ç½®&lt;/p>
&lt;/blockquote>
&lt;h2 id="é…ç½®ä¸­æ–‡è¾“å…¥æ³•">é…ç½®ä¸­æ–‡è¾“å…¥æ³•&lt;/h2>
&lt;ol>
&lt;li>Open Settings, go to &lt;code>Region &amp;amp; Language&lt;/code> -&amp;gt; &lt;code>Manage Installed Languages&lt;/code> -&amp;gt; &lt;code>Install / Remove languages&lt;/code>.&lt;/li>
&lt;li>Select &lt;code>Chinese (Simplified)&lt;/code>. Make sure &lt;code>Keyboard Input method system&lt;/code> has &lt;code>Ibus&lt;/code> selected. Apply.&lt;/li>
&lt;li>Reboot&lt;/li>
&lt;li>Log back in, reopen Settings, go to &lt;code>Keyboard&lt;/code>.&lt;/li>
&lt;li>Click on the &amp;ldquo;+&amp;rdquo; sign under &lt;code>Input sources&lt;/code>.&lt;/li>
&lt;li>Select &lt;code>Chinese (China)&lt;/code> and then &lt;code>Chinese (Intelligent Pinyin)&lt;/code>.&lt;/li>
&lt;/ol>
&lt;p>&lt;a href="https://askubuntu.com/questions/1408873/ubuntu-22-04-chinese-simplified-pinyin-input-support">ubuntu-22-04-chinese-simplified-pinyin-input-support&lt;/a>&lt;/p>
&lt;h2 id="ä¿®æ­£ç®€ä½“ä¸­æ–‡æ˜¾ç¤ºä¸ºå¼‚ä½“æ—¥æ–‡å­—å½¢">ä¿®æ­£ç®€ä½“ä¸­æ–‡æ˜¾ç¤ºä¸ºå¼‚ä½“(æ—¥æ–‡)å­—å½¢&lt;/h2>
&lt;blockquote>
&lt;p>ubuntu/linuxå¯¹ä¸­æ–‡æ”¯æŒçš„ä¸å¤ªå¥½, åœ¨é€‰æ‹©æ±‰å­—å­—ä½“æ—¶, ä¼˜å…ˆé€‰æ‹©çš„æ˜¯æ—¥æ–‡æˆ–è€…éŸ©æ–‡, éœ€è¦æ‰‹åŠ¨è°ƒæ•´ä¼˜å…ˆçº§åé‡å¯æ“ä½œç³»ç»Ÿè§£å†³&lt;/p></description></item><item><title>è§£å†³Goåº”ç”¨åœ¨å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜</title><link>/posts/solve-timezone-issue-in-go-application-in-container/</link><pubDate>Sat, 18 Feb 2023 16:12:01 +0800</pubDate><guid>/posts/solve-timezone-issue-in-go-application-in-container/</guid><description>&lt;h2 id="å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜">å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜&lt;/h2>
&lt;p>åº”ç”¨ç›´æ¥è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šéœ€è¦è®¾ç½®æœåŠ¡å™¨æ—¶åŒºä¸ºä¸œå…«åŒºï¼Œç°åœ¨å¾ˆå¤šåº”ç”¨éƒ½æ˜¯éƒ¨ç½²åœ¨å®¹å™¨ä¸­äº†ï¼ŒåŒæ ·ä¹Ÿæ˜¯è¦è®¾ç½®å®¹å™¨é•œåƒçš„æ—¶åŒºã€‚&lt;/p>
&lt;p>è®¸å¤šå®¹å™¨é•œåƒé»˜è®¤æ—¶åŒºä¸º &lt;code>UTC&lt;/code> (&lt;a href="https://zh.wikipedia.org/zh-hans/%E5%8D%8F%E8%B0%83%E4%B8%96%E7%95%8C%E6%97%B6">Coordinated Universal Time åè°ƒä¸–ç•Œæ—¶&lt;/a>)ï¼Œæ¯”ä¸œå…«åŒºæ…¢å…«ä¸ªå°æ—¶ï¼Œå½“ç¨‹åºæ¶‰åŠæ•°æ®åº“å†™å…¥æ“ä½œæˆ–è€…æ—¥å¿—è®°å½•ç­‰åŠŸèƒ½æ—¶å°±ä¼šæœ‰æ—¶é—´å·®ã€‚&lt;/p>
&lt;p>å¸¸è§„è§£å†³æ–¹æ¡ˆä¸€èˆ¬ä¸¤å¤§ç±»&lt;/p>
&lt;ol>
&lt;li>build dockeré•œåƒæ—¶å°±æŠŠé•œåƒå†…çš„æ—¶åŒºè®¾ç½®ä¸º &lt;code>Asia/Shanghai&lt;/code>&lt;/li>
&lt;li>è¿è¡Œå®¹å™¨æ—¶æŠŠæœ¬åœ°æ—¶åŒºæ­£å¸¸çš„ä¸»æœºçš„æ—¶åŒºé…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="çœ‹ä¸€ä¸‹-go-æ˜¯å¦‚ä½•è¯»å–æ—¶åŒºæ–‡ä»¶å¹¶è®¾ç½®-timetime-çš„æ—¶åŒºçš„">çœ‹ä¸€ä¸‹ &lt;code>Go&lt;/code> æ˜¯å¦‚ä½•è¯»å–æ—¶åŒºæ–‡ä»¶å¹¶è®¾ç½® &lt;code>time.Time&lt;/code> çš„æ—¶åŒºçš„&lt;/h3>
&lt;p>&lt;code>Go&lt;/code> æºç  &lt;a href="https://github.com/golang/go/blob/master/src/time/zoneinfo_unix.go">src/time/zoneinfo_unix.go&lt;/a> ä¸­ä»£ç å’Œæ³¨é‡Šéƒ½å¾ˆæ¸…æ™°ğŸ‘&lt;/p>
&lt;pre>&lt;code class="language-golang">package time

import (
 &amp;quot;syscall&amp;quot;
)

// Many systems use /usr/share/zoneinfo, Solaris 2 has
// /usr/share/lib/zoneinfo, IRIX 6 has /usr/lib/locale/TZ,
// NixOS has /etc/zoneinfo.
var platformZoneSources = []string{
 &amp;quot;/usr/share/zoneinfo/&amp;quot;,
 &amp;quot;/usr/share/lib/zoneinfo/&amp;quot;,
 &amp;quot;/usr/lib/locale/TZ/&amp;quot;,
 &amp;quot;/etc/zoneinfo&amp;quot;,
}

func initLocal() {
 // consult $TZ to find the time zone to use.
 // no $TZ means use the system default /etc/localtime.
 // $TZ=&amp;quot;&amp;quot; means use UTC.
 // $TZ=&amp;quot;foo&amp;quot; or $TZ=&amp;quot;:foo&amp;quot; if foo is an absolute path, then the file pointed
 // by foo will be used to initialize timezone; otherwise, file
 // /usr/share/zoneinfo/foo will be used.

 tz, ok := syscall.Getenv(&amp;quot;TZ&amp;quot;)
 switch {
 case !ok:
 z, err := loadLocation(&amp;quot;localtime&amp;quot;, []string{&amp;quot;/etc&amp;quot;})
 if err == nil {
 localLoc = *z
 localLoc.name = &amp;quot;Local&amp;quot;
 return
 }
 case tz != &amp;quot;&amp;quot;:
 if tz[0] == ':' {
 tz = tz[1:]
 }
 if tz != &amp;quot;&amp;quot; &amp;amp;&amp;amp; tz[0] == '/' {
 if z, err := loadLocation(tz, []string{&amp;quot;&amp;quot;}); err == nil {
 localLoc = *z
 if tz == &amp;quot;/etc/localtime&amp;quot; {
 localLoc.name = &amp;quot;Local&amp;quot;
 } else {
 localLoc.name = tz
 }
 return
 }
 } else if tz != &amp;quot;&amp;quot; &amp;amp;&amp;amp; tz != &amp;quot;UTC&amp;quot; {
 if z, err := loadLocation(tz, platformZoneSources); err == nil {
 localLoc = *z
 return
 }
 }
 }

 // Fall back to UTC.
 localLoc.name = &amp;quot;UTC&amp;quot;
}
&lt;/code>&lt;/pr</description></item><item><title>SQLite3</title><link>/posts/sqlite3/</link><pubDate>Tue, 14 Dec 2021 10:33:14 +0800</pubDate><guid>/posts/sqlite3/</guid><description>&lt;h2 id="rollbackæ—¥å¿—æ¨¡å¼ä¸‹çš„äº”ç§é”çŠ¶æ€ä»‹ç»">rollbackæ—¥å¿—æ¨¡å¼ä¸‹çš„äº”ç§é”çŠ¶æ€ä»‹ç»&lt;/h2>
&lt;ul>
&lt;li>&lt;code>UNLOCKED&lt;/code>
&lt;ul>
&lt;li>æ²¡é”çŠ¶æ€&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>SHARED&lt;/code>
&lt;ul>
&lt;li>è·å–&lt;code>SHARED&lt;/code>é”æ‰èƒ½æ‰§è¡Œè¯»æ“ä½œï¼Œä¸€ä¸ªæ•°æ®åº“å¯åŒæ—¶å­˜åœ¨å¤šä¸ª&lt;code>SHARED&lt;/code>é”&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>RESERVED&lt;/code>
&lt;ul>
&lt;li>è·å–&lt;code>RESERVED&lt;/code>é”æ‰èƒ½åœ¨æœªæ¥å†™æ•°æ®åº“ï¼Œä¸€ä¸ªæ•°æ®åº“åŒä¸€æ—¶é—´åªèƒ½å­˜åœ¨ä¸€ä¸ª&lt;code>RESERVED&lt;/code>é”&lt;/li>
&lt;li>æœ‰&lt;code>RESERVED&lt;/code>é”æ—¶è¯´æ˜è¿˜æ²¡å¼€å§‹å†™ï¼Œæ‰€ä»¥æœ‰&lt;code>RESERVED&lt;/code>é”æ—¶å¯ä»¥è·å–æ–°çš„&lt;code>SHARED&lt;/code>é”&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>PENDING&lt;/code>
&lt;ul>
&lt;li>æœ‰&lt;code>PENDING&lt;/code>é”æ„å‘³ç€è¦å¼€å§‹å†™äº†ï¼Œä½†æ˜¯æ­¤æ—¶æœ‰å…¶ä»–è¿æ¥æ‹¥æœ‰&lt;code>SHARED&lt;/code>é”åœ¨è¯»æ•°æ®ï¼Œæ­¤æ—¶å†™æ“ä½œåªèƒ½ç­‰å¾…æ‰€æœ‰&lt;code>SHARED&lt;/code>é‡Šæ”¾ã€‚&lt;/li>
&lt;li>&lt;code>PENDING&lt;/code>é˜»å¡å…¶ä»–è¿æ¥è·å–æ–°çš„&lt;code>SHARED&lt;/code>é”ï¼Œå½“&lt;code>SHARED&lt;/code>é”é‡Šæ”¾å®Œæ—¶è½¬ä¸º&lt;code>EXCLUSIVE&lt;/code>é”å¼€å§‹å†™æ“ä½œã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>EXCLUSIVE&lt;/code>
&lt;ul>
&lt;li>åŒä¸€æ—¶é—´åªèƒ½å­˜åœ¨ä¸€ä¸ª&lt;code>EXCLUSIVE&lt;/code>é”ï¼Œå¹¶ä¸”æœ‰&lt;code>EXCLUSIVE&lt;/code>é”å­˜åœ¨æ—¶ä¸å…è®¸å…¶ä»–ä»»ä½•é”ç±»å‹å­˜åœ¨ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>æ‰€ä»¥æ€»ç»“ä¸€ä¸‹å°±æ˜¯è¯»è¯»å¯å¹¶å‘ï¼Œè¯»å†™ä¸å¯å¹¶å‘ï¼Œå†™å†™ä¸å¯å¹¶å‘ã€‚&lt;/p>
&lt;h2 id="ä¼˜åŒ–ç¯‡">ä¼˜åŒ–ç¯‡&lt;/h2>
&lt;h3 id="sqlite_busy-é—®é¢˜">&lt;code>SQLITE_BUSY&lt;/code> é—®é¢˜&lt;/h3>
&lt;p>çœ‹åˆ°ä¸Šé¢è¿™ä¹ˆå¤šé”ä¸èƒ½å…±å­˜çš„æƒ…å†µåº”è¯¥ä¼šæƒ³åˆ°ï¼Œå†²çªä¼šå¾ˆé¢‘ç¹ï¼Œå¦‚ &lt;code>EXCLUSIVE&lt;/code> é”å­˜åœ¨æ—¶ä¸å…è®¸å…¶ä»–è¿æ¥è·å–ä»»ä½•é”ï¼Œå½“å…¶ä»–è¿›ç¨‹éœ€è¦è¯»å†™æ“ä½œæ—¶å°±ä¼šè·å–é”å¤±è´¥ï¼Œç«‹å³æŠ¥ &lt;code>SQLITE_BUSY&lt;/code> é”™è¯¯ã€‚&lt;/p>
&lt;p>è®¾ç½® &lt;code>busy_timeout&lt;/code> å°±ä¸ä¼šç«‹å³è¿”å› &lt;code>SQLITE_BUSY&lt;/code>ï¼Œä¼šå®šæ—¶retryå¤±è´¥çš„æ“ä½œï¼Œå¦‚æœåœ¨è®¾ç½®çš„ &lt;code>busy_timeout&lt;/code> æ—¶é—´å†…è¿˜æ²¡æ‰§è¡ŒæˆåŠŸï¼Œä¾ç„¶ä¼šè¿”å› &lt;code>SQLITE_BUSY&lt;/code>ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ä¸åŒsqliteé©±åŠ¨ï¼Œè®¾ç½® &lt;code>busy_timeout&lt;/code> çš„æ–¹å¼ä¸åŒ&lt;/p>
&lt;ul>
&lt;li>modernc.org/sqlite &lt;code>database.db?_pragma=busy_timeout%3d50000&lt;/code>&lt;/li>
&lt;li>github.com/mattn/go-sqlite3 &lt;code>database.db?_busy_timeout=50000&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>Shared cache mode æ”¯æŒ table level locksï¼Œæš‚æ—¶è¿˜æ²¡ç ”ç©¶ã€‚&lt;/p>
&lt;h3 id="é’ˆå¯¹å†™æ“ä½œæ…¢çš„é—®é¢˜">é’ˆå¯¹å†™æ“ä½œæ…¢çš„é—®é¢˜&lt;/h3>
&lt;p>è§£å†³æ–¹æ¡ˆï¼šå°†å¤šä¸ªå†™æ“ä½œæ”¾å…¥ä¸€ä¸ªäº‹åŠ¡é‡Œæ‰§è¡Œã€‚sqliteå®˜æ–¹&lt;a href="https://www.sqlite.org/faq.html#q19">FAQ&lt;/a>å¯¹å…¶è§£é‡Šå¦‚ä¸‹&lt;/p></description></item><item><title>Vim Tricks</title><link>/posts/vim-tricks/</link><pubDate>Wed, 24 Nov 2021 21:45:54 +0800</pubDate><guid>/posts/vim-tricks/</guid><description>&lt;h2 id="æ‰¹é‡æ›¿æ¢">æ‰¹é‡æ›¿æ¢&lt;/h2>
&lt;p>æ‰¹é‡æ›¿æ¢ v1.6.1 ä¸º v2.7.0&lt;/p>
&lt;pre>&lt;code class="language-bash">:%s/v1.6.1/v2.7.0/g
&lt;/code>&lt;/pre>
&lt;h2 id="ä¸¤è¡Œåˆä¸ºä¸€è¡Œ">ä¸¤è¡Œåˆä¸ºä¸€è¡Œ&lt;/h2>
&lt;p>&lt;code>NORMAL&lt;/code> æ¨¡å¼ä¸‹æŒ‰ &lt;code>shift + j&lt;/code> å°±ä¼šå°†å…‰æ ‡ä¸‹ä¸€è¡Œåˆå¹¶åˆ°å½“å‰è¡Œè¡Œå°¾&lt;/p></description></item><item><title>å‡å°goç¨‹åºç¼–è¯‘åçš„ä½“ç§¯</title><link>/posts/go-app-reduce-size/</link><pubDate>Mon, 22 Nov 2021 10:29:02 +0800</pubDate><guid>/posts/go-app-reduce-size/</guid><description>&lt;h2 id="ç¼–è¯‘ç»å…¸ç¨‹åº">ç¼–è¯‘ç»å…¸ç¨‹åº&lt;/h2>
&lt;h3 id="ç¨‹åºä»£ç ">ç¨‹åºä»£ç &lt;/h3>
&lt;pre>&lt;code class="language-golang">package main

import &amp;quot;fmt&amp;quot;

func main() {
 fmt.Println(&amp;quot;Hello World.&amp;quot;)
}
&lt;/code>&lt;/pre>
&lt;h3 id="ç¼–è¯‘ç¯å¢ƒ">ç¼–è¯‘ç¯å¢ƒ&lt;/h3>
&lt;pre>&lt;code class="language-bash">$ go version
go version go1.16.7 linux/amd64
&lt;/code>&lt;/pre>
&lt;h2 id="0-ç›´æ¥ç¼–è¯‘">0. ç›´æ¥ç¼–è¯‘&lt;/h2>
&lt;pre>&lt;code class="language-bash">$ go build -o helloword main.go
$ ls -lh helloword 
-rwxrwxr-x 1 gobai gobai 1.9M Nov 23 09:34 helloword
&lt;/code>&lt;/pre>
&lt;h2 id="1-ä¿®æ”¹ç¼–è¯‘é€‰é¡¹">1. ä¿®æ”¹ç¼–è¯‘é€‰é¡¹&lt;/h2>
&lt;p>é™¤å»ç¼–è¯‘æ—¶å¸¦çš„ç¬¦å·è¡¨å’Œè°ƒè¯•ä¿¡æ¯&lt;/p>
&lt;pre>&lt;code class="language-bash">$ go build -ldflags=&amp;quot;-s -w&amp;quot; -o helloword main.go
$ ls -lh helloword 
-rwxrwxr-x 1 gobai gobai 1.3M Nov 23 09:38 helloword
&lt;/code>&lt;/pr</description></item><item><title>About Systemd</title><link>/posts/systemd-journal/</link><pubDate>Sun, 14 Nov 2021 01:47:04 +0800</pubDate><guid>/posts/systemd-journal/</guid><description>&lt;p>è®°å½•ä¸€ä¸‹æŸ¥çœ‹å’Œæ“ä½œ &lt;code>systemd&lt;/code> æ—¥å¿—çš„å‡ ä¸ªå¸¸ç”¨å‘½ä»¤&lt;/p>
&lt;h2 id="å¸¸ç”¨è¿‡æ»¤æ—¥å¿—æ—¥å¿—çš„å‘½ä»¤">å¸¸ç”¨è¿‡æ»¤æ—¥å¿—æ—¥å¿—çš„å‘½ä»¤&lt;/h2>
&lt;h3 id="æ ¹æ®æ—¶é—´çº¦æŸè¿‡æ»¤æ—¥å¿—">æ ¹æ®æ—¶é—´çº¦æŸè¿‡æ»¤æ—¥å¿—&lt;/h3>
&lt;h4 id="è·å–-2023-01-15-000000-ä¹‹åçš„æ—¥å¿—">è·å– &lt;code>2023-01-15 00:00:00&lt;/code> ä¹‹åçš„æ—¥å¿—&lt;/h4>
&lt;pre>&lt;code class="language-bash">journalctl --since '2023-01-15 00:00:00'
&lt;/code>&lt;/pre>
&lt;h4 id="è·å–-2023-01-15-000000-ä¹‹å-2023-01-15-120000-ä¹‹å‰çš„æ—¥å¿—">è·å– &lt;code>2023-01-15 00:00:00&lt;/code> ä¹‹å, &lt;code>2023-01-15 12:00:00&lt;/code> ä¹‹å‰çš„æ—¥å¿—&lt;/h4>
&lt;pre>&lt;code class="language-bash">journalctl --since '2023-01-15 00:00:00' --until '2023-01-15 12:00:00'
&lt;/code>&lt;/pre>
&lt;h3 id="åªæŸ¥çœ‹ä¸€ä¸ªæœåŠ¡unitçš„æ—¥å¿—">åªæŸ¥çœ‹ä¸€ä¸ªæœåŠ¡(Unit)çš„æ—¥å¿—&lt;/h3>
&lt;pre>&lt;code class="language-bash">journalctl -u nginx
&lt;/code>&lt;/pre>
&lt;h3 id="è‡ªç”±ç»„åˆçº¦æŸæ¡ä»¶">è‡ªç”±ç»„åˆçº¦æŸæ¡ä»¶&lt;/h3>
&lt;pre>&lt;code class="language-bash">journalctl -u nginx --since '2023-01-15 00:00:00' --until '2023-01-15 12:00:00'
&lt;/code>&lt;/pre>
&lt;h2 id="æŸ¥çœ‹æ—¥å¿—å ç”¨ç£ç›˜é‡">æŸ¥çœ‹æ—¥å¿—å ç”¨ç£ç›˜é‡&lt;/h2>
&lt;pre>&lt;code class="language-bash">journalctl --disk-usage
&lt;/code>&lt;/pre>
&lt;pre>&lt;code class="language-bash">Output
Archived and active journals take up 3.9G in the file system.
&lt;/code>&lt;/pr</description></item><item><title>Git Tricks</title><link>/posts/git-tricks/</link><pubDate>Fri, 12 Nov 2021 15:36:19 +0800</pubDate><guid>/posts/git-tricks/</guid><description>&lt;h2 id="æš‚å­˜å½“å‰ä»£ç æ”¹åŠ¨">æš‚å­˜å½“å‰ä»£ç æ”¹åŠ¨&lt;/h2>
&lt;p>åœºæ™¯æ˜¯åœ¨ä¸€ä¸ªgit branchå†™äº†ä¸å°‘ä»£ç ä»¥åå‘ç°å†™é”™åˆ†æ”¯äº†ï¼Œæ€»ä¸èƒ½åˆ äº†å†é‡æ–°å†™å§ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>git stash&lt;/code> å‘½ä»¤è§£å†³ã€‚&lt;/p>
&lt;pre>&lt;code class="language-bash"># å°†å½“å‰æ”¹åŠ¨çš„ä»£ç æš‚å­˜
git stash
# git checkout åˆ°ä½ è¦å·¥ä½œçš„åˆ†æ”¯
git checkout your_workspace_branch
# æŠŠæš‚å­˜çš„ä»£ç ä»å †æ ˆå¼¹å‡ºåˆ°å½“å‰åˆ†æ”¯
git stash pop
&lt;/code>&lt;/pre></description></item></channel></rss>