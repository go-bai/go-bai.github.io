<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on gobai's blog</title><link>/posts/</link><description>Recent content in Posts on gobai's blog</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Mon, 01 Jul 2024 21:24:49 +0800</lastBuildDate><atom:link href="/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>RKE2</title><link>/posts/rke2/</link><pubDate>Mon, 01 Jul 2024 21:24:49 +0800</pubDate><guid>/posts/rke2/</guid><description>é€šè¿‡RKE2å¿«é€Ÿæ­å»ºæµ‹è¯•ä½¿ç”¨çš„k8sé›†ç¾¤ç¯å¢ƒ
ç¯å¢ƒå‡†å¤‡ å‡†å¤‡bridgeç½‘ç»œbr0 å‡†å¤‡ubuntu 22.04 server qcow2é•œåƒ å‡†å¤‡libvirtç¯å¢ƒ åˆ›å»ºè™šæ‹Ÿæœº å‡†å¤‡ cloudinit é•œåƒ cat &amp;lt;&amp;lt;EOFALL &amp;gt; gen-cloudinit-iso.sh #!/bin/bash set -eux CLOUD_INIT_DIR=&amp;quot;/var/lib/libvirt/disks/\${VM}/cloudinit&amp;quot; FILENAME=&amp;quot;\${CLOUD_INIT_DIR}/init.iso&amp;quot; mkdir -p \${CLOUD_INIT_DIR} cat &amp;lt;&amp;lt;EOF &amp;gt; \${CLOUD_INIT_DIR}/meta-data instance-id: \${VM} local-hostname: \${VM} EOF # æ›´å¤šé…ç½®å‚ç…§ https://cloudinit.readthedocs.io/en/latest/explanation/format.html cat &amp;lt;&amp;lt;EOF &amp;gt; \${CLOUD_INIT_DIR}/user-data #cloud-config EOF # å‚è€ƒ kubevirt /pkg/cloud-init/cloud-init.go:defaultIsoFunc xorrisofs -output \$FILENAME -volid cidata -joliet -rock -partition_cyl_align on \${CLOUD_INIT_DIR}/user-data \${CLOUD_INIT_DIR}/meta-data EOFALL VM=k8s-node01 bash gen-cloudinit-iso.sh å‡†å¤‡ç³»ç»Ÿç›˜å¹¶åˆ›å»ºè™šæ‹Ÿæœº VM=k8s-node01 mkdir -p /var/lib/libvirt/disks/${VM} qemu-img create -f qcow2 -F qcow2 -b /var/lib/libvirt/images/ubuntu.</description></item><item><title>Cloudinit</title><link>/posts/cloudinit/</link><pubDate>Sun, 30 Jun 2024 23:56:57 +0800</pubDate><guid>/posts/cloudinit/</guid><description>cloudinit ä»‹ç» ç”¨äºåœ¨æ–°å»ºçš„è™šæ‹Ÿæœºä¸­è¿›è¡Œæ—¶é—´è®¾ç½®ã€å¯†ç è®¾ç½®ã€æ‰©å±•æ ¹æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨åˆ†åŒºã€è®¾ç½®ä¸»æœºåã€è¿è¡Œè„šæœ¬ã€å®‰è£…è½¯ä»¶åŒ…ç­‰åˆå§‹åŒ–è®¾ç½®
cloudinit iso é•œåƒåˆ¶ä½œ åˆ›å»ºè„šæœ¬ cat &amp;lt;&amp;lt;EOFALL &amp;gt; gen-cloudinit-iso.sh #!/bin/bash set -eux CLOUD_INIT_DIR=&amp;quot;/var/lib/libvirt/disks/\${VM}/cloudinit&amp;quot; FILENAME=&amp;quot;\${CLOUD_INIT_DIR}/init.iso&amp;quot; mkdir -p \${CLOUD_INIT_DIR} cat &amp;lt;&amp;lt;EOF &amp;gt; \${CLOUD_INIT_DIR}/meta-data instance-id: \${VM} local-hostname: \${VM} EOF # æ›´å¤šé…ç½®å‚ç…§ https://cloudinit.readthedocs.io/en/latest/explanation/format.html cat &amp;lt;&amp;lt;EOF &amp;gt; \${CLOUD_INIT_DIR}/user-data #cloud-config EOF # å‚è€ƒ kubevirt /pkg/cloud-init/cloud-init.go:defaultIsoFunc xorrisofs -output \$FILENAME -volid cidata -joliet -rock -partition_cyl_align on \${CLOUD_INIT_DIR}/user-data \${CLOUD_INIT_DIR}/meta-data EOFALL ç”Ÿæˆ cloudinit iso VM=k8s-node01 bash gen-cloudinit-iso.sh ä½¿ç”¨ åˆ›å»ºä¸€ä¸ªk8sèŠ‚ç‚¹è™šæ‹Ÿæœº
VM=k8s-node01 mkdir -p /var/lib/libvirt/disks/${VM} qemu-img create -f qcow2 -F qcow2 -b /var/lib/libvirt/images/ubuntu.</description></item><item><title>Controller Runtime</title><link>/posts/controller-runtime/</link><pubDate>Sat, 01 Jun 2024 10:42:13 +0800</pubDate><guid>/posts/controller-runtime/</guid><description>controller-runtimeæ˜¯åœ¨client-go/tools/cacheå’Œclient-go/util/workqueueçš„åŸºç¡€ä¸Šå®ç°çš„, äº†è§£client-go/tools/cacheå’Œclient-go/util/workqueueå¯¹ç†è§£controller-runtimeå¾ˆæœ‰å¸®åŠ©
ä»‹ç»informer å¸¦ç€é—®é¢˜çœ‹
å¼€å‘CRDæ—¶æƒ³åˆ°çš„ä¸€äº›é—®é¢˜ æ›´æ–°local storeç¼“å­˜å’Œè§¦å‘reconcileæ˜¯å¦æœ‰å…ˆåé¡ºåº åŒä¸€ä¸ªcrd objectä¼šä¸ä¼šåŒæ—¶è¢«reconcile è¿™ä¸ªå…¨é Queueæ•°æ®ç»“æ„è®¾è®¡çš„ç²¾å¦™, ä¿è¯äº†æ­£åœ¨æ‰§è¡Œçš„reconcileä¸ä¼šå¤„ç†ç›¸åŒçš„object
å‘queueä¸­å¢åŠ objectä¹‹å‰ä¼šæ£€æŸ¥æ˜¯å¦æœ‰æ¬¡objectå­˜åœ¨äºqueueä¸­ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åŠ å…¥dirty setï¼Œå¦‚æœä¹Ÿä¸å­˜åœ¨äºprocessing setæ‰ä¼šåŠ å…¥queueä¸­ï¼Œå½“processingä¸­çš„å¤„ç†å®Œæˆä¹‹åï¼ˆè°ƒç”¨Doneï¼‰ï¼Œä¼šå°†objectä»processing setç§ç§»é™¤ï¼Œå¦‚æœæ¬¡objectåœ¨å¤„ç†è¿‡ç¨‹ä¸­åŠ å…¥åˆ°äº†dirty setï¼Œåˆ™å°†objectå†æ¬¡åŠ å…¥åˆ°queueä¸­ https://www.cnblogs.com/daniel-hutao/p/18010835/k8s_clientgo_workqueue
æœ‰å‡ ç§é˜Ÿåˆ—ï¼ŒQueueï¼ŒDelayingQueueï¼ŒRateLimitingQueue
å¦‚ä½•è§£å†³è¿›å…¥reconcileä¹‹åè¯»åˆ°çš„æ˜¯æ—§æ•°æ®çš„é—®é¢˜ è¯»åˆ°æ—§æ•°æ®æ˜¯å¦è¯´æ˜æ˜¯å…ˆå‡ºå‘reconcileå†æ›´æ–°local storeçš„
My cache might be stale if I read from a cache! How should I deal with that?
åœ¨æ›´æ–°æˆ–patch statusä¹‹åï¼Œé€šè¿‡wait.Pool(100ms, 2s, func()(bool, error))æ ¡éªŒcacheä¸­çš„æœ¬objectæ•°æ®ç›´è‡³æ›´æ–°
https://github.com/kubernetes-sigs/controller-runtime/blob/main/FAQ.md#q-my-cache-might-be-stale-if-i-read-from-a-cache-how-should-i-deal-with-that
https://github.com/kubernetes/test-infra/blob/8f0f19a905a20ed6f76386e5e11343d4bc2446a7/prow/plank/reconciler.go#L516-L520</description></item><item><title>Kubevirt Hook Sidecar</title><link>/posts/kubevirt-sidecar/</link><pubDate>Sun, 12 May 2024 14:37:18 +0800</pubDate><guid>/posts/kubevirt-sidecar/</guid><description>ç®€ä»‹ èƒŒæ™¯ åœ¨kubevirtä¸­, é€šè¿‡vmiçš„specæ²¡åŠæ³•æ¶µç›–æ‰€æœ‰çš„libvirt domain xmlå…ƒç´ , æ‰€ä»¥æœ‰äº†hook sidecaråŠŸèƒ½æ¥å…è®¸æˆ‘ä»¬åœ¨define domainä¹‹å‰è‡ªå®šä¹‰domainSpecXML
åŠŸèƒ½ä»‹ç» åœ¨kubevirtä¸­, Hook Sidecarå®¹å™¨æ˜¯sidecar container(å’Œmain application containerè·‘åœ¨åŒä¸€ä¸ªpodä¸­)ç”¨æ¥åœ¨vmåˆå§‹åŒ–å®Œæˆå‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰æ“ä½œ.
sidecar containerä¸main container(compute)é€šè¿‡gRPCé€šè®¯, æœ‰ä¸¤ç§ä¸»è¦çš„sidecar hooks
OnDefineDomain: è¿™ä¸ªhookå¸®åŠ©è‡ªå®šä¹‰libvirtçš„XML, å¹¶é€šè¿‡gRPCåè®®è¿”å›æœ€æ–°çš„XMLä»¥åˆ›å»ºvm PreCloudInitIso: è¿™ä¸ªhookå¸®åŠ©å®šä¹‰cloud-inité…ç½®, å®ƒè¿è¡Œå¹¶è¿”å›æœ€æ–°çš„cloud-init data Shutdown: è¿™ä¸ªæ˜¯v1alpha3ç‰ˆæœ¬æ‰æ”¯æŒçš„ ä½¿ç”¨hook sidecaråŠŸèƒ½éœ€è¦åœ¨kv.spec.configuration.developerConfiguration.featureGatesä¸­å¼€å¯SidecaråŠŸèƒ½
æºç åˆ†æ kubevirt-boot-sidecar ä»‹ç» ä»¥ä¸‹ä»¥kubevirt-boot-sidecarä¸ºä¾‹è®²è¿°sidecarçš„å·¥ä½œæµç¨‹, è¿™ä¸ªsidecaræ”¯æŒä¿®æ”¹å¼•å¯¼è®¾å¤‡é¡ºåº(boot)å’Œå¼€å¯äº¤äº’å¼å¼•å¯¼èœå•(bootmenu)
kubevirt-boot-sidecaråªå®ç°äº†OnDefineDomain, ä¸‹é¢ä¹Ÿæ˜¯ä¸»è¦ä¸²ä¸€ä¸‹OnDefineDomainç›¸å…³çš„
sidecarå·¥ä½œæµç¨‹ virt-launcheråˆšå¯åŠ¨æ—¶æ”¶é›†æ‰€æœ‰sidecarä¿¡æ¯ // cmd/virt-launcher/virt-launcher.go func main() { hookSidecars := pflag.Uint(&amp;quot;hook-sidecars&amp;quot;, 0, &amp;quot;Number of requested hook sidecars, virt-launcher will wait for all of them to become available&amp;quot;) // æ”¶é›†æ‰€æœ‰sidecarçš„ä¿¡æ¯ err := hookManager.Collect(*hookSidecars, *qemuTimeout) // å¯åŠ¨ cmd server, è¿™é‡Œé¢æœ‰ SyncVirtualMachine æ–¹æ³•, å…·ä½“çš„å®ç°åœ¨ func (l *LibvirtDomainManager) SyncVMI // virt-handleråœ¨åˆå§‹åŒ–å®Œè™šæ‹Ÿæœºç¡¬ç›˜ç­‰ä¹‹åä¼šé€šè¿‡ SyncVirtualMachine è°ƒç”¨SyncVMIå‡½æ•°å¼€å§‹åˆ›å»ºdomain // SyncVMIå°†vmi specè½¬æ¢ä¸ºdomainSpec, ç„¶åè°ƒç”¨hooksManager.</description></item><item><title>æ— çº¿è½¬æœ‰çº¿ç½‘ç»œ</title><link>/posts/wireless-to-wired-network/</link><pubDate>Tue, 09 Apr 2024 22:16:24 +0800</pubDate><guid>/posts/wireless-to-wired-network/</guid><description>é€šè¿‡æ— çº¿ç½‘å¡è¿æ¥ç½‘ç»œA(192.168.31.0/24), æ— çº¿ç½‘å¡ç›¸å½“äºWANå£ï¼Œé€šè¿‡æœ‰çº¿ç½‘å¡æ¥å…¥ç½‘ç»œB(192.168.1.0/24), æœ‰çº¿ç½‘å¡ç›¸å½“äºLANå£
å‡†å¤‡ä¸€ä¸ªubuntuè™šæ‹Ÿæœºrouter # å‡†å¤‡qcow2åŸºç¡€é•œåƒ wget https://down.idc.wiki/Image/realServer-Template/current/qcow2/ubuntu22.qcow2 -O /var/lib/libvirt/images/ubuntu.qcow2 # åˆ›å»ºè™šæ‹Ÿæœºä»¥åŸºç¡€é•œåƒä¸ºbacking fileçš„å¢é‡ç›˜ qemu-img create -f qcow2 -F qcow2 -b /var/lib/libvirt/images/ubuntu.qcow2 /var/lib/libvirt/disks/router.qcow2 20G # åˆ›å»ºå¹¶å¯åŠ¨è™šæ‹Ÿæœº virt-install --name router --memory 512 --vcpus 1 --disk /var/lib/libvirt/disks/router.qcow2,bus=sata --import --os-variant ubuntu22.10 --network bridge=br0 --noautoconsole # è®¾ç½®è‡ªåŠ¨å¯åŠ¨ virsh autostart router é…ç½®ç½‘ç»œ å°†æ— çº¿ç½‘å¡é€ä¼ è¿›è™šæ‹Ÿæœº æ‰“å¼€ virt-manager -&amp;gt; åŒå‡» router domain -&amp;gt; ç‚¹å‡» Show virtual hardware details -&amp;gt; ç‚¹å‡» Add Hardware -&amp;gt; ç‚¹å‡» PCI Host Device -&amp;gt; é€‰æ‹© Intel Corporation Wi-Fi 6 AX200 -&amp;gt; ç‚¹å‡» Finish</description></item><item><title>Rclone</title><link>/posts/rclone/</link><pubDate>Thu, 04 Apr 2024 15:56:58 +0800</pubDate><guid>/posts/rclone/</guid><description>ä½¿ç”¨rcloneå’Œalistæä¾›çš„webdavæ¥å£å°†é˜¿é‡Œäº‘ç›˜mountåˆ°Ubuntu 22.04çš„ç›®å½•ä¸Š, å®ç°åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·è®¿é—®é˜¿é‡Œäº‘ç›˜å†…çš„æ–‡ä»¶
ä¸‹è½½å®‰è£…rclone curl https://rclone.org/install.sh | bash é…ç½®rclone config # rclone config No remotes found, make a new one? n) New remote s) Set configuration password q) Quit config n/s/q&amp;gt; n Enter name for new remote. name&amp;gt; alist Option Storage. Type of storage to configure. Choose a number from below, or type in your own value. 1 / 1Fichier \ (fichier) ... 51 / WebDAV \ (webdav) ... Storage&amp;gt; 51 Option url.</description></item><item><title>Multi-Bootable USB</title><link>/posts/multi-bootable-usb/</link><pubDate>Thu, 28 Mar 2024 22:20:22 +0800</pubDate><guid>/posts/multi-bootable-usb/</guid><description>ä»ä¸€ä¸ªUSBè®¾å¤‡(Uç›˜)å¯åŠ¨å¤šä¸ªæ“ä½œç³»ç»Ÿ, å¹¶ä¸”Uç›˜è¿˜èƒ½ç»§ç»­å­˜å‚¨å…¶ä»–æ™®é€šæ–‡ä»¶
ä¸‹è½½å¹¶è§£å‹ventoy wget https://github.com/ventoy/Ventoy/releases/download/v1.0.97/ventoy-1.0.97-linux.tar.gz tar -xvzf ventoy-1.0.97-linux.tar.gz cd ventoy-1.0.97/ Ventoy2Disk.shç”¨æ¥å®‰è£…ventoråˆ°Uç›˜
./Ventoy2Disk.sh -h ********************************************** Ventoy: 1.0.97 x86_64 longpanda admin@ventoy.net https://www.ventoy.net ********************************************** Usage: Ventoy2Disk.sh CMD [ OPTION ] /dev/sdX CMD: -i install Ventoy to sdX (fails if disk already installed with Ventoy) -I force install Ventoy to sdX (no matter if installed or not) -u update Ventoy in sdX -l list Ventoy information in sdX OPTION: (optional) -r SIZE_MB preserve some space at the bottom of the disk (only for install) -s/-S enable/disable secure boot support (default is enabled) -g use GPT partition style, default is MBR (only for install) -L Label of the 1st exfat partition (default is Ventoy) -n try non-destructive installation (only for install) å®‰è£…ventoy # .</description></item><item><title>Shell Script</title><link>/posts/shell-script/</link><pubDate>Sat, 23 Mar 2024 09:43:34 +0800</pubDate><guid>/posts/shell-script/</guid><description>æœ€è¿‘å†™çš„shellè„šæœ¬æ¯”è¾ƒå¤šï¼Œè®°å½•ä¸€äº›å¸¸ç”¨å‘½ä»¤, ç›¸å½“äºè®°å½•ä¸€ä¸ªç´¢å¼•, ä»¥åç”¨æ—¶å¯ä»¥å¿«é€Ÿå›å¿†èµ·æ¥.
#!/bin/bash #!/bin/bashè¢«ç§°ä¸ºshebang line, æŒ‡å®šæ‰§è¡Œæ­¤è„šæœ¬æ–‡ä»¶æ—¶ä½¿ç”¨/bin/bashåšä¸ºshellè§£é‡Šå™¨ç¨‹åº
å¾ˆå¤šä¸»æµæ“ä½œç³»ç»Ÿé»˜è®¤çš„shellè§£é‡Šå™¨ä¹Ÿæ˜¯bash
# echo $SHELL /bin/bash set setå‘½ä»¤ç”¨æ¥ä¿®æ”¹shellç¯å¢ƒçš„è¿è¡Œå‚æ•°, å®Œæ•´çš„å¯å®šåˆ¶çš„å®˜æ–¹æ‰‹å†Œ
ä¸‹é¢æ˜¯æˆ‘å¸¸ç”¨çš„å‡ ä¸ª, å¯ä»¥åˆå¹¶ä¸ºå¦‚ä¸‹å†…å®¹å†™åœ¨è„šæœ¬å¼€å¤´:
#!/bin/bash set -uxe set -o pipefail set -u æ‰§è¡Œè„šæœ¬æ—¶, å¦‚æœé‡åˆ°ä¸å­˜åœ¨çš„å˜é‡, Bashé»˜è®¤ä¼šå¿½ç•¥, set -uå¯ä»¥è®©è„šæœ¬è¯»åˆ°ä¸å­˜åœ¨å˜é‡æ—¶æŠ¥é”™
set -x å‘½ä»¤æ‰§è¡Œå‰ä¼šå…ˆæ‰“å°å‡ºæ¥, è¡Œé¦–ä»¥+è¡¨ç¤º, åœ¨è°ƒè¯•è„šæœ¬æ—¶éå¸¸æœ‰å¸®åŠ©
set -e æ‰§è¡Œè„šæœ¬æ—¶, Bashé‡åˆ°é”™è¯¯é»˜è®¤ä¼šç»§ç»­æ‰§è¡Œ, set -eä½¿å¾—è„šæœ¬åªè¦å‘ç”Ÿé”™è¯¯, å°±ä¸­æ­¢æ‰§è¡Œ
set -o pipefail set -eæœ‰ä¸€ä¸ªä¾‹å¤–æƒ…å†µ, å°±æ˜¯ä¸é€‚ç”¨äºç®¡é“å‘½ä»¤, æ¯”å¦‚ä¸‹é¢çš„ä¸ä¼šé€€å‡º
#!/bin/bash set -e foo | echo a echo bar æ‰§è¡Œçš„ç»“æœä¸º:
a set.sh: line 4: foo: command not found bar set -o pipefailå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜, åªè¦ä¸€ä¸ªå­å‘½ä»¤å¤±è´¥, æ•´ä¸ªç®¡é“å‘½ä»¤å°±å¤±è´¥, è„šæœ¬å°±ä¼šç»ˆæ­¢æ‰§è¡Œ</description></item><item><title>sqlx vs xorm</title><link>/posts/sqlx-vs-xorm/</link><pubDate>Sat, 09 Mar 2024 10:49:09 +0800</pubDate><guid>/posts/sqlx-vs-xorm/</guid><description>åˆå§‹åŒ–æ¼”ç¤ºç¯å¢ƒ ä½¿ç”¨dockeréƒ¨ç½² éƒ¨ç½²çš„å½“å‰æ—¶é—´æœ€æ–°ç‰ˆæœ¬postgres:16.2
docker run -d --name pgsql \ -e POSTGRES_USER=admin \ -e POSTGRES_PASSWORD=passwd \ -e POSTGRES_DB=testdb \ -p 15432:5432 \ postgres:16.2 ä½¿ç”¨psqlè¿æ¥ docker exec -it pgsql psql -U admin -d testdb åˆå§‹åŒ–user,vpså’Œhostè¡¨ CREATE TABLE &amp;quot;user&amp;quot; ( id bigserial PRIMARY KEY, username VARCHAR(255) NOT NULL, password VARCHAR(255) NOT NULL ); CREATE TABLE &amp;quot;host&amp;quot; ( id bigserial PRIMARY KEY, hostname VARCHAR(255) NOT NULL ); CREATE TABLE &amp;quot;vps&amp;quot; ( id bigserial PRIMARY KEY, user_id bigint NOT NULL, host_id bigint NOT NULL, name VARCHAR(255) NOT NULL, sys_disk jsonb NOT NULL DEFAULT '{}' ); æŸ¥çœ‹åˆ›å»ºå‡ºçš„è¡¨ testdb=# \z Access privileges Schema | Name | Type | Access privileges | Column privileges | Policies --------+-------------+----------+-------------------+-------------------+---------- public | host | table | | | public | host_id_seq | sequence | | | public | user | table | | | public | user_id_seq | sequence | | | public | vps | table | | | public | vps_id_seq | sequence | | | (6 rows) testdb=# \d user Table &amp;quot;public.</description></item><item><title>OpenWrt</title><link>/posts/openwrt/</link><pubDate>Sat, 06 Jan 2024 17:38:38 +0800</pubDate><guid>/posts/openwrt/</guid><description>å¾ˆä¹…æ²¡æŠ˜è…¾OpenWrtäº†, å›Šä¸­ç¾æ¶©, æ²¡æœ‰å…¶ä»–åˆé€‚çš„è®¾å¤‡, è¿™æ¬¡æ˜¯åœ¨KVMè™šæœºä¸­è¿è¡Œä½¿ç”¨(ALL IN BOOM!)
å…ˆäº®ä¸ªå½“å‰çš„ç©·äººç‰ˆå®¶åº­ç½‘ç»œæ‹“æ‰‘å›¾
å‡†å¤‡qcow2é•œåƒ é¦–å…ˆä¸‹è½½æœ€æ–°çš„é•œåƒ, æˆªæ­¢ç›®å‰æœ€æ–°ç‰ˆä¸º23.05.3, æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯x86-64çš„é•œåƒ
wget https://mirror-03.infra.openwrt.org/releases/23.05.3/targets/x86/64/openwrt-23.05.3-x86-64-generic-ext4-combined.img.gz # è§£å‹ gunzip openwrt-23.05.3-x86-64-generic-ext4-combined.img.gz # è¿™é‡Œå› ä¸ºæˆ‘è¦ä½œä¸ºKVMè™šæ‹Ÿæœºçš„é•œåƒ, æ‰€ä»¥è½¬æ¢ä¸ºqcow2æ ¼å¼. å¦‚æœæ˜¯åœ¨ç‰©ç†æœºä¸Šéƒ¨ç½², å¯ä»¥ç›´æ¥ç›´æ¥åˆ·åˆ°Uç›˜ä¸Š. qemu-img convert -f raw openwrt-23.05.3-x86-64-generic-ext4-combined.img -O qcow2 /var/lib/libvirt/images/openwrt.qcow2 è¿è¡Œè™šæœº æˆ‘æ˜¯ç”¨libvirtæ¥ç®¡ç†qemu/kvmè™šæ‹Ÿæœº, å¦‚æœæ²¡å®‰è£…è¦å…ˆå®‰è£…
apt install virt-manager qemu bridge-utils -y æˆ‘è¿™é‡Œå°†é•œåƒå¤åˆ¶åˆ°äº†/var/lib/libvirt/disks/ç›®å½•ä¸‹
qemu-img create -f qcow2 -F qcow2 -b /var/lib/libvirt/images/openwrt.qcow2 /var/lib/libvirt/disks/openwrt.qcow2 1G ä½¿ç”¨virt-installè¿è¡Œ,
# è¿è¡Œ, è¿™é‡Œç½‘ç»œæŒ‡å®šçš„ä¹‹å‰æ–‡ç« ä¸­åˆ›å»ºçš„ç½‘æ¡¥ç½‘ç»œbr0 virt-install --name openwrt --memory 256 --vcpus 1 --network bridge=br0,model=virtio --disk path=/var/lib/libvirt/disks/openwrt.qcow2,bus=ide --import --autostart --osinfo detect=on,require=off --graphics vnc,listen=0.</description></item><item><title>dhclient</title><link>/posts/dhclient/</link><pubDate>Mon, 09 Oct 2023 21:37:55 +0800</pubDate><guid>/posts/dhclient/</guid><description>åœ¨æœºå™¨ä¸Šä½¿ç”¨netplan+NetworkManageré…ç½®bridged networkä¹‹å
æœ€è¿‘ç»å¸¸ç”µè„‘ç”¨ç€ç”¨ç€å°±ä¸èƒ½è”ç½‘äº†ï¼Œå‘ç°enp1s0æ€»æ˜¯å¶å°”å†’å‡ºä¸€ä¸ªipv4åœ°å€ï¼Œå¹¶ä¸”è·¯ç”±è¡¨ä¼šå¤šå‡ºä¸€ä¸ªä»enp1s0å‡ºå»çš„defaultè·¯ç”±ã€‚åæ¥çœ‹journalctlæ—¥å¿—å‘ç°æ˜¯dhclientæçš„äº‹æƒ…(å­¦è‰ºä¸ç²¾, æ²¡ç¬¬ä¸€æ—¶é—´è”ç³»èµ·æ¥)ã€‚
ä¸‹é¢æ˜¯éƒ¨åˆ†æ—¥å¿—ï¼š
âœ ~ journalctl -n 1000000 | grep '192.168.1.22\|enp1s0' ... 10æœˆ 09 20:14:25 gobai-SER dhclient[107299]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x4745a8ce) 10æœˆ 09 20:14:26 gobai-SER dhclient[73666]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x2cfc74b3) 10æœˆ 09 20:14:26 gobai-SER dhclient[157839]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x453b8549) 10æœˆ 09 20:14:28 gobai-SER dhclient[170251]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.</description></item><item><title>Creating a bridged network with netplan on Ubuntu 22.04</title><link>/posts/creating-a-bridged-network-with-netplan-on-ubuntu-22-04/</link><pubDate>Wed, 04 Oct 2023 13:01:59 +0800</pubDate><guid>/posts/creating-a-bridged-network-with-netplan-on-ubuntu-22-04/</guid><description>æœ¬åœ°LANç¯å¢ƒ
LANç½‘å…³ 192.168.1.1 å­ç½‘æ©ç  255.255.255.0 DHCPèŒƒå›´ 192.168.1.2-192.168.32 åˆ›å»ºä¸€ä¸ªbridged network åˆ›å»ºä¸€ä¸ªç½‘æ¡¥br0ç»™è™šæœºä½¿ç”¨ï¼Œä½¿å¾—è™šæœºå’Œå…¶ä»–è®¾å¤‡éƒ½åœ¨ä¸€ä¸ªLANä¸‹
æ€»é…ç½®(netplan get)å¦‚ä¸‹:
network: version: 2 renderer: NetworkManager ethernets: enp1s0: dhcp4: false dhcp6: false bridges: br0: addresses: - &amp;quot;192.168.1.100/24&amp;quot; nameservers: addresses: - 192.168.1.1 dhcp4: false dhcp6: false interfaces: - enp1s0 parameters: stp: false routes: - to: &amp;quot;default&amp;quot; via: &amp;quot;192.168.1.1&amp;quot; ç”±ä¸‰ä¸ªæ–‡ä»¶ç»„æˆ:
/etc/netplan/01-network-manager-all.yaml # Let NetworkManager manage all devices on this system network: version: 2 renderer: NetworkManager /etc/netplan/10-ethernet-enp1s0.yaml network: ethernets: enp1s0: dhcp4: false dhcp6: false /etc/netplan/99-bridged-network-br0.</description></item><item><title>åˆ é™¤åˆ†åŒºå¹¶æ‰©å®¹å¦ä¸€ä¸ªåˆ†åŒºå’Œæ ¹æ–‡ä»¶ç³»ç»Ÿ</title><link>/posts/delete-partition-and-expand-another/</link><pubDate>Mon, 02 Oct 2023 16:54:05 +0800</pubDate><guid>/posts/delete-partition-and-expand-another/</guid><description>ç°åœ¨è¦å°† /dev/sda3 åˆ†åŒºåˆ æ‰å¹¶æ‰©å®¹åˆ° /dev/sda2, å¹¶ä¸”åœ¨ä¸é‡å¯æœåŠ¡å™¨çš„æƒ…å†µä¸‹æ‰©å®¹æ ¹æ–‡ä»¶ç³»ç»Ÿ(è·Ÿæ–‡ä»¶ç³»ç»Ÿ / æŒ‚è½½åœ¨ /dev/sda2 ä¸Š, å¹¶ä¸” filesystem æ˜¯ ext4)
ç£ç›˜åˆå§‹åˆ†åŒºå’ŒæŒ‚è½½æƒ…å†µ âœ ~ lsblk /dev/sda NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 100G 0 disk â”œâ”€sda1 8:1 0 512M 0 part /boot/efi â”œâ”€sda2 8:2 0 98.5G 0 part / â””â”€sda3 8:3 0 976M 0 part âœ ~ fdisk -l /dev/sda Disk /dev/sda: 100 GiB, 107374182400 bytes, 209715200 sectors Disk model: BlockVolume Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 4096 bytes I/O size (minimum/optimal): 4096 bytes / 1048576 bytes Disklabel type: gpt Disk identifier: 40BED670-8B91-4520-9785-DB1F1035C039 Device Start End Sectors Size Type /dev/sda1 2048 1050623 1048576 512M EFI System /dev/sda2 1050624 207714303 206663680 98.</description></item><item><title>Vscode Extensions</title><link>/posts/vscode-extensions/</link><pubDate>Mon, 25 Sep 2023 21:27:06 +0800</pubDate><guid>/posts/vscode-extensions/</guid><description>è®°å½•æˆ‘çš„vscodeä½¿ç”¨çš„æ‰©å±•æ’ä»¶ æŒç»­è¡¥å……ä¸­
vscode-icons-mac GitLens Go Remote - SSH shellman REST Client Todo Tree ä¸€äº›é…ç½® &amp;quot;workbench.tree.indent&amp;quot;: 16</description></item><item><title>MacOS Config</title><link>/posts/macos-config/</link><pubDate>Sun, 24 Sep 2023 10:56:13 +0800</pubDate><guid>/posts/macos-config/</guid><description>å®‰è£…iproute2mac å¯ä»¥å’Œåœ¨linuxæ“ä½œç³»ç»Ÿä¸€æ ·ä½¿ç”¨ipå‘½ä»¤æŸ¥çœ‹å’Œç®¡ç†ç½‘ç»œ, èµ!!!
brew install iproute2mac sshé…ç½®alive é…ç½®ServerAliveInterval, é˜²æ­¢é•¿æ—¶é—´æ²¡æœ‰æ•°æ®äº¤äº’åè¿æ¥æ–­æ‰
# cat ~/.ssh/config Host * ServerAliveInterval 30 Host home HostName 192.168.1.100 User root ...</description></item><item><title>Ubuntu Config</title><link>/posts/ubuntu-config/</link><pubDate>Sun, 24 Sep 2023 10:56:12 +0800</pubDate><guid>/posts/ubuntu-config/</guid><description>ä»¥ä¸‹é…ç½®éƒ½æ˜¯åœ¨ Ubuntu 22.04 ç³»ç»Ÿé…ç½®
é…ç½®ä¸­æ–‡è¾“å…¥æ³• Open Settings, go to Region &amp;amp; Language -&amp;gt; Manage Installed Languages -&amp;gt; Install / Remove languages. Select Chinese (Simplified). Make sure Keyboard Input method system has Ibus selected. Apply. Reboot Log back in, reopen Settings, go to Keyboard. Click on the &amp;ldquo;+&amp;rdquo; sign under Input sources. Select Chinese (China) and then Chinese (Intelligent Pinyin). ubuntu-22-04-chinese-simplified-pinyin-input-support
æ¢aptæº https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/
sudo su - cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/apt/sources.list # é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š deb https://mirrors.</description></item><item><title>è§£å†³Goåº”ç”¨åœ¨å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜</title><link>/posts/solve-timezone-issue-in-go-application-in-container/</link><pubDate>Sat, 18 Feb 2023 16:12:01 +0800</pubDate><guid>/posts/solve-timezone-issue-in-go-application-in-container/</guid><description>å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜ åº”ç”¨ç›´æ¥è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šéœ€è¦è®¾ç½®æœåŠ¡å™¨æ—¶åŒºä¸ºä¸œå…«åŒºï¼Œç°åœ¨å¾ˆå¤šåº”ç”¨éƒ½æ˜¯éƒ¨ç½²åœ¨å®¹å™¨ä¸­äº†ï¼ŒåŒæ ·ä¹Ÿæ˜¯è¦è®¾ç½®å®¹å™¨é•œåƒçš„æ—¶åŒºã€‚
è®¸å¤šå®¹å™¨é•œåƒé»˜è®¤æ—¶åŒºä¸º UTC (Coordinated Universal Time åè°ƒä¸–ç•Œæ—¶)ï¼Œæ¯”ä¸œå…«åŒºæ…¢å…«ä¸ªå°æ—¶ï¼Œå½“ç¨‹åºæ¶‰åŠæ•°æ®åº“å†™å…¥æ“ä½œæˆ–è€…æ—¥å¿—è®°å½•ç­‰åŠŸèƒ½æ—¶å°±ä¼šæœ‰æ—¶é—´å·®ã€‚
å¸¸è§„è§£å†³æ–¹æ¡ˆä¸€èˆ¬ä¸¤å¤§ç±»
build dockeré•œåƒæ—¶å°±æŠŠé•œåƒå†…çš„æ—¶åŒºè®¾ç½®ä¸º Asia/Shanghai è¿è¡Œå®¹å™¨æ—¶æŠŠæœ¬åœ°æ—¶åŒºæ­£å¸¸çš„ä¸»æœºçš„æ—¶åŒºé…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ã€‚ çœ‹ä¸€ä¸‹ Go æ˜¯å¦‚ä½•è¯»å–æ—¶åŒºæ–‡ä»¶å¹¶è®¾ç½® time.Time çš„æ—¶åŒºçš„ Go æºç  src/time/zoneinfo_unix.go ä¸­ä»£ç å’Œæ³¨é‡Šéƒ½å¾ˆæ¸…æ™°ğŸ‘
package time import ( &amp;quot;syscall&amp;quot; ) // Many systems use /usr/share/zoneinfo, Solaris 2 has // /usr/share/lib/zoneinfo, IRIX 6 has /usr/lib/locale/TZ, // NixOS has /etc/zoneinfo. var platformZoneSources = []string{ &amp;quot;/usr/share/zoneinfo/&amp;quot;, &amp;quot;/usr/share/lib/zoneinfo/&amp;quot;, &amp;quot;/usr/lib/locale/TZ/&amp;quot;, &amp;quot;/etc/zoneinfo&amp;quot;, } func initLocal() { // consult $TZ to find the time zone to use. // no $TZ means use the system default /etc/localtime.</description></item><item><title>SQLite3 Note</title><link>/posts/sqlite3-notes/</link><pubDate>Tue, 14 Dec 2021 10:33:14 +0800</pubDate><guid>/posts/sqlite3-notes/</guid><description>rollbackæ—¥å¿—æ¨¡å¼ä¸‹çš„äº”ç§é”çŠ¶æ€ä»‹ç» UNLOCKED æ²¡é”çŠ¶æ€ SHARED è·å–SHAREDé”æ‰èƒ½æ‰§è¡Œè¯»æ“ä½œï¼Œä¸€ä¸ªæ•°æ®åº“å¯åŒæ—¶å­˜åœ¨å¤šä¸ªSHAREDé” RESERVED è·å–RESERVEDé”æ‰èƒ½åœ¨æœªæ¥å†™æ•°æ®åº“ï¼Œä¸€ä¸ªæ•°æ®åº“åŒä¸€æ—¶é—´åªèƒ½å­˜åœ¨ä¸€ä¸ªRESERVEDé” æœ‰RESERVEDé”æ—¶è¯´æ˜è¿˜æ²¡å¼€å§‹å†™ï¼Œæ‰€ä»¥æœ‰RESERVEDé”æ—¶å¯ä»¥è·å–æ–°çš„SHAREDé” PENDING æœ‰PENDINGé”æ„å‘³ç€è¦å¼€å§‹å†™äº†ï¼Œä½†æ˜¯æ­¤æ—¶æœ‰å…¶ä»–è¿æ¥æ‹¥æœ‰SHAREDé”åœ¨è¯»æ•°æ®ï¼Œæ­¤æ—¶å†™æ“ä½œåªèƒ½ç­‰å¾…æ‰€æœ‰SHAREDé‡Šæ”¾ã€‚ PENDINGé˜»å¡å…¶ä»–è¿æ¥è·å–æ–°çš„SHAREDé”ï¼Œå½“SHAREDé”é‡Šæ”¾å®Œæ—¶è½¬ä¸ºEXCLUSIVEé”å¼€å§‹å†™æ“ä½œã€‚ EXCLUSIVE åŒä¸€æ—¶é—´åªèƒ½å­˜åœ¨ä¸€ä¸ªEXCLUSIVEé”ï¼Œå¹¶ä¸”æœ‰EXCLUSIVEé”å­˜åœ¨æ—¶ä¸å…è®¸å…¶ä»–ä»»ä½•é”ç±»å‹å­˜åœ¨ã€‚ æ‰€ä»¥æ€»ç»“ä¸€ä¸‹å°±æ˜¯è¯»è¯»å¯å¹¶å‘ï¼Œè¯»å†™ä¸å¯å¹¶å‘ï¼Œå†™å†™ä¸å¯å¹¶å‘ã€‚
ä¼˜åŒ–ç¯‡ SQLITE_BUSY é—®é¢˜ çœ‹åˆ°ä¸Šé¢è¿™ä¹ˆå¤šé”ä¸èƒ½å…±å­˜çš„æƒ…å†µåº”è¯¥ä¼šæƒ³åˆ°ï¼Œå†²çªä¼šå¾ˆé¢‘ç¹ï¼Œå¦‚ EXCLUSIVE é”å­˜åœ¨æ—¶ä¸å…è®¸å…¶ä»–è¿æ¥è·å–ä»»ä½•é”ï¼Œå½“å…¶ä»–è¿›ç¨‹éœ€è¦è¯»å†™æ“ä½œæ—¶å°±ä¼šè·å–é”å¤±è´¥ï¼Œç«‹å³æŠ¥ SQLITE_BUSY é”™è¯¯ã€‚
è®¾ç½® busy_timeout å°±ä¸ä¼šç«‹å³è¿”å› SQLITE_BUSYï¼Œä¼šå®šæ—¶retryå¤±è´¥çš„æ“ä½œï¼Œå¦‚æœåœ¨è®¾ç½®çš„ busy_timeout æ—¶é—´å†…è¿˜æ²¡æ‰§è¡ŒæˆåŠŸï¼Œä¾ç„¶ä¼šè¿”å› SQLITE_BUSYã€‚
ä½¿ç”¨ä¸åŒsqliteé©±åŠ¨ï¼Œè®¾ç½® busy_timeout çš„æ–¹å¼ä¸åŒ
modernc.org/sqlite database.db?_pragma=busy_timeout%3d50000 github.com/mattn/go-sqlite3 database.db?_busy_timeout=50000 Shared cache mode æ”¯æŒ table level locksï¼Œæš‚æ—¶è¿˜æ²¡ç ”ç©¶ã€‚
é’ˆå¯¹å†™æ“ä½œæ…¢çš„é—®é¢˜ è§£å†³æ–¹æ¡ˆï¼šå°†å¤šä¸ªå†™æ“ä½œæ”¾å…¥ä¸€ä¸ªäº‹åŠ¡é‡Œæ‰§è¡Œã€‚sqliteå®˜æ–¹FAQå¯¹å…¶è§£é‡Šå¦‚ä¸‹
(19) INSERT is really slow - I can only do few dozen INSERTs per second Actually, SQLite will easily do 50,000 or more INSERT statements per second on an average desktop computer.</description></item><item><title>Vim Tricks</title><link>/posts/vim-tricks/</link><pubDate>Wed, 24 Nov 2021 21:45:54 +0800</pubDate><guid>/posts/vim-tricks/</guid><description>æ‰¹é‡æ›¿æ¢ æ‰¹é‡æ›¿æ¢ v1.6.1 ä¸º v2.7.0
:%s/v1.6.1/v2.7.0/g ä¸¤è¡Œåˆä¸ºä¸€è¡Œ NORMAL æ¨¡å¼ä¸‹æŒ‰ shift + j å°±ä¼šå°†å…‰æ ‡ä¸‹ä¸€è¡Œåˆå¹¶åˆ°å½“å‰è¡Œè¡Œå°¾</description></item><item><title>å‡å°goç¨‹åºç¼–è¯‘åçš„ä½“ç§¯</title><link>/posts/go-app-reduce-size/</link><pubDate>Mon, 22 Nov 2021 10:29:02 +0800</pubDate><guid>/posts/go-app-reduce-size/</guid><description>ç¼–è¯‘ç»å…¸ç¨‹åº ç¨‹åºä»£ç  package main import &amp;quot;fmt&amp;quot; func main() { fmt.Println(&amp;quot;Hello World.&amp;quot;) } ç¼–è¯‘ç¯å¢ƒ $ go version go version go1.16.7 linux/amd64 0. ç›´æ¥ç¼–è¯‘ $ go build -o helloword main.go $ ls -lh helloword -rwxrwxr-x 1 gobai gobai 1.9M Nov 23 09:34 helloword 1. ä¿®æ”¹ç¼–è¯‘é€‰é¡¹ é™¤å»ç¼–è¯‘æ—¶å¸¦çš„ç¬¦å·è¡¨å’Œè°ƒè¯•ä¿¡æ¯
$ go build -ldflags=&amp;quot;-s -w&amp;quot; -o helloword main.go $ ls -lh helloword -rwxrwxr-x 1 gobai gobai 1.3M Nov 23 09:38 helloword 2. ä½¿ç”¨ UPX å¯¹ç›´æ¥ç¼–è¯‘å‡ºçš„äºŒè¿›åˆ¶ä½¿ç”¨ upx è¿›ä¸€æ­¥å‹ç¼©</description></item><item><title>About Systemd</title><link>/posts/systemd-journal/</link><pubDate>Sun, 14 Nov 2021 01:47:04 +0800</pubDate><guid>/posts/systemd-journal/</guid><description>è®°å½•ä¸€ä¸‹æŸ¥çœ‹å’Œæ“ä½œ systemd æ—¥å¿—çš„å‡ ä¸ªå¸¸ç”¨å‘½ä»¤
å¸¸ç”¨è¿‡æ»¤æ—¥å¿—æ—¥å¿—çš„å‘½ä»¤ æ ¹æ®æ—¶é—´çº¦æŸè¿‡æ»¤æ—¥å¿— è·å– 2023-01-15 00:00:00 ä¹‹åçš„æ—¥å¿— journalctl --since '2023-01-15 00:00:00' è·å– 2023-01-15 00:00:00 ä¹‹å, 2023-01-15 12:00:00 ä¹‹å‰çš„æ—¥å¿— journalctl --since '2023-01-15 00:00:00' --until '2023-01-15 12:00:00' åªæŸ¥çœ‹ä¸€ä¸ªæœåŠ¡(Unit)çš„æ—¥å¿— journalctl -u nginx è‡ªç”±ç»„åˆçº¦æŸæ¡ä»¶ journalctl -u nginx --since '2023-01-15 00:00:00' --until '2023-01-15 12:00:00' æŸ¥çœ‹æ—¥å¿—å ç”¨ç£ç›˜é‡ journalctl --disk-usage Output Archived and active journals take up 3.9G in the file system. åˆ é™¤æ—§çš„æ—¥å¿— åªä¿ç•™æœ€è¿‘ ä¸€ä¸ªæœˆ çš„æ—¥å¿— journalctl --vacuum-time=1month åªä¿ç•™æœ€è¿‘ 1G çš„æ—¥å¿— journalctl --vacuum-size=1G åˆ—å‡ºæ‰€æœ‰systemdæœåŠ¡ systemctl list-units --type=service --all</description></item><item><title>Git Tricks</title><link>/posts/git-tricks/</link><pubDate>Fri, 12 Nov 2021 15:36:19 +0800</pubDate><guid>/posts/git-tricks/</guid><description>æš‚å­˜å½“å‰ä»£ç æ”¹åŠ¨ åœºæ™¯æ˜¯åœ¨ä¸€ä¸ªgit branchå†™äº†ä¸å°‘ä»£ç ä»¥åå‘ç°å†™é”™åˆ†æ”¯äº†ï¼Œæ€»ä¸èƒ½åˆ äº†å†é‡æ–°å†™å§ï¼Œå¯ä»¥ä½¿ç”¨ git stash å‘½ä»¤è§£å†³ã€‚
# å°†å½“å‰æ”¹åŠ¨çš„ä»£ç æš‚å­˜ git stash # git checkout åˆ°ä½ è¦å·¥ä½œçš„åˆ†æ”¯ git checkout your_workspace_branch # æŠŠæš‚å­˜çš„ä»£ç ä»å †æ ˆå¼¹å‡ºåˆ°å½“å‰åˆ†æ”¯ git stash pop</description></item></channel></rss>