<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Storage on gobai's notes</title><link>/posts/linux/storage/</link><description>Recent content in Storage on gobai's notes</description><generator>Hugo</generator><language>en-us</language><atom:link href="/posts/linux/storage/index.xml" rel="self" type="application/rss+xml"/><item><title>Linux 磁盘分区</title><link>/posts/partitioning-disks/</link><pubDate>Sat, 15 Mar 2025 20:31:35 +0800</pubDate><guid>/posts/partitioning-disks/</guid><description>&lt;p>&lt;a href="https://www.baeldung.com/linux/partitioning-disks">https://www.baeldung.com/linux/partitioning-disks&lt;/a>
&lt;a href="https://en.wikipedia.org/wiki/Master_boot_record">https://en.wikipedia.org/wiki/Master_boot_record&lt;/a>
&lt;a href="https://www.cnblogs.com/god-of-death/p/18221794">https://www.cnblogs.com/god-of-death/p/18221794&lt;/a>&lt;/p>
&lt;h2 id="概览">
 概览
 &lt;a class="anchor" href="#%e6%a6%82%e8%a7%88">#&lt;/a>
&lt;/h2>
&lt;p>通常安装 Linux 系统的第一步就是磁盘分区。在我们创建任何文件前需要先存在文件系统。&lt;/p>
&lt;p>分区被用来将原始存储空间分割成大块，可以用来隔离文件系统故障。&lt;/p>
&lt;h2 id="磁盘类型-disk-types">
 磁盘类型 (Disk Types)
 &lt;a class="anchor" href="#%e7%a3%81%e7%9b%98%e7%b1%bb%e5%9e%8b-disk-types">#&lt;/a>
&lt;/h2>
&lt;h3 id="分区表格式-mbr-和-gpt">
 分区表格式 MBR 和 GPT
 &lt;a class="anchor" href="#%e5%88%86%e5%8c%ba%e8%a1%a8%e6%a0%bc%e5%bc%8f-mbr-%e5%92%8c-gpt">#&lt;/a>
&lt;/h3>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/Master_boot_record">MBR&lt;/a> (Master Boot Record) 和 &lt;a href="https://en.wikipedia.org/wiki/GUID_Partition_Table">GPT&lt;/a> (GUID Partition Table) 是最广泛使用的分区表，相较于 GPT，MBR 是一个老的标准并且有一些限制。&lt;/p>
&lt;h3 id="bios-和-uefi">
 BIOS 和 UEFI
 &lt;a class="anchor" href="#bios-%e5%92%8c-uefi">#&lt;/a>
&lt;/h3>
&lt;h3 id="分区工具">
 分区工具
 &lt;a class="anchor" href="#%e5%88%86%e5%8c%ba%e5%b7%a5%e5%85%b7">#&lt;/a>
&lt;/h3>
&lt;p>&lt;code>fdisk&lt;/code> 和 &lt;code>parted&lt;/code>&lt;/p>
&lt;p>TODO&lt;/p></description></item><item><title>Linux 文件系统之 inode</title><link>/posts/inode/</link><pubDate>Thu, 13 Mar 2025 12:08:49 +0800</pubDate><guid>/posts/inode/</guid><description>&lt;p>TODO&lt;/p>
&lt;p>&lt;a href="https://www.ruanyifeng.com/blog/2011/12/inode.html">https://www.ruanyifeng.com/blog/2011/12/inode.html&lt;/a>&lt;/p>
&lt;h2 id="inode-是什么">
 inode 是什么
 &lt;a class="anchor" href="#inode-%e6%98%af%e4%bb%80%e4%b9%88">#&lt;/a>
&lt;/h2>
&lt;p>inode 是 Linux 文件系统中的一个重要概念，它是一个文件的元数据，记录了文件的权限、类型、大小、创建时间、修改时间等信息。&lt;/p>
&lt;h2 id="inode-的结构">
 inode 的结构
 &lt;a class="anchor" href="#inode-%e7%9a%84%e7%bb%93%e6%9e%84">#&lt;/a>
&lt;/h2>
&lt;p>inode 的结构如下:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>struct inode &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> umode_t i_mode; // 文件类型和权限
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uid_t i_uid; // 文件所有者
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gid_t i_gid; // 文件所属组
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> loff_t i_size; // 文件大小
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> struct timespec i_atime; // 文件访问时间
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> struct timespec i_ctime; // 文件创建时间
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> struct timespec i_mtime; // 文件修改时间
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="使用场景">
 使用场景
 &lt;a class="anchor" href="#%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af">#&lt;/a>
&lt;/h2>
&lt;h3 id="通过-inode-查找并删除文件">
 通过 inode 查找并删除文件
 &lt;a class="anchor" href="#%e9%80%9a%e8%bf%87-inode-%e6%9f%a5%e6%89%be%e5%b9%b6%e5%88%a0%e9%99%a4%e6%96%87%e4%bb%b6">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ls -li&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>total &lt;span style="color:#ae81ff">32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">459&lt;/span> -rw-r--r-- &lt;span style="color:#ae81ff">1&lt;/span> root root &lt;span style="color:#ae81ff">20070&lt;/span> Mar &lt;span style="color:#ae81ff">13&lt;/span> 11:27 &lt;span style="color:#e6db74">&amp;#39;&amp;#39;$&amp;#39;\033\033&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">526984&lt;/span> drwxr-xr-x &lt;span style="color:#ae81ff">5&lt;/span> root root &lt;span style="color:#ae81ff">4096&lt;/span> Jan &lt;span style="color:#ae81ff">1&lt;/span> 17:47 charts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">784&lt;/span> drwxr-xr-x &lt;span style="color:#ae81ff">2&lt;/span> root root &lt;span style="color:#ae81ff">4096&lt;/span> Jan &lt;span style="color:#ae81ff">19&lt;/span> 20:42 pods
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">49203&lt;/span> drwx------ &lt;span style="color:#ae81ff">3&lt;/span> root root &lt;span style="color:#ae81ff">4096&lt;/span> Feb &lt;span style="color:#ae81ff">10&lt;/span> &lt;span style="color:#ae81ff">2023&lt;/span> snap
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># find . -inum 459&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>./??
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># find . -inum 459 -delete&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ls -li&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>total &lt;span style="color:#ae81ff">12&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">526984&lt;/span> drwxr-xr-x &lt;span style="color:#ae81ff">5&lt;/span> root root &lt;span style="color:#ae81ff">4096&lt;/span> Jan &lt;span style="color:#ae81ff">1&lt;/span> 17:47 charts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">784&lt;/span> drwxr-xr-x &lt;span style="color:#ae81ff">2&lt;/span> root root &lt;span style="color:#ae81ff">4096&lt;/span> Jan &lt;span style="color:#ae81ff">19&lt;/span> 20:42 pods
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">49203&lt;/span> drwx------ &lt;span style="color:#ae81ff">3&lt;/span> root root &lt;span style="color:#ae81ff">4096&lt;/span> Feb &lt;span style="color:#ae81ff">10&lt;/span> &lt;span style="color:#ae81ff">2023&lt;/span> snap
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="参考">
 参考
 &lt;a class="anchor" href="#%e5%8f%82%e8%80%83">#&lt;/a>
&lt;/h2></description></item><item><title>删除分区并扩容另一个分区和根文件系统</title><link>/posts/delete-partition-and-expand-another/</link><pubDate>Mon, 02 Oct 2023 16:54:05 +0800</pubDate><guid>/posts/delete-partition-and-expand-another/</guid><description>&lt;blockquote>
&lt;p>现在要将 &lt;code>/dev/sda3&lt;/code> 分区删掉并扩容到 &lt;code>/dev/sda2&lt;/code>, 并且在不重启服务器的情况下扩容根文件系统(跟文件系统 &lt;code>/&lt;/code> 挂载在 &lt;code>/dev/sda2&lt;/code> 上, 并且 filesystem 是 &lt;code>ext4&lt;/code>)&lt;/p>&lt;/blockquote>
&lt;h2 id="磁盘初始分区和挂载情况">
 磁盘初始分区和挂载情况
 &lt;a class="anchor" href="#%e7%a3%81%e7%9b%98%e5%88%9d%e5%a7%8b%e5%88%86%e5%8c%ba%e5%92%8c%e6%8c%82%e8%bd%bd%e6%83%85%e5%86%b5">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>➜ ~ lsblk /dev/sda
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sda 8:0 &lt;span style="color:#ae81ff">0&lt;/span> 100G &lt;span style="color:#ae81ff">0&lt;/span> disk 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>├─sda1 8:1 &lt;span style="color:#ae81ff">0&lt;/span> 512M &lt;span style="color:#ae81ff">0&lt;/span> part /boot/efi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>├─sda2 8:2 &lt;span style="color:#ae81ff">0&lt;/span> 98.5G &lt;span style="color:#ae81ff">0&lt;/span> part /
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>└─sda3 8:3 &lt;span style="color:#ae81ff">0&lt;/span> 976M &lt;span style="color:#ae81ff">0&lt;/span> part 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>➜ ~ fdisk -l /dev/sda
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disk /dev/sda: &lt;span style="color:#ae81ff">100&lt;/span> GiB, &lt;span style="color:#ae81ff">107374182400&lt;/span> bytes, &lt;span style="color:#ae81ff">209715200&lt;/span> sectors
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disk model: BlockVolume 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Units: sectors of &lt;span style="color:#ae81ff">1&lt;/span> * 512 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Sector size &lt;span style="color:#f92672">(&lt;/span>logical/physical&lt;span style="color:#f92672">)&lt;/span>: &lt;span style="color:#ae81ff">512&lt;/span> bytes / &lt;span style="color:#ae81ff">4096&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>I/O size &lt;span style="color:#f92672">(&lt;/span>minimum/optimal&lt;span style="color:#f92672">)&lt;/span>: &lt;span style="color:#ae81ff">4096&lt;/span> bytes / &lt;span style="color:#ae81ff">1048576&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disklabel type: gpt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disk identifier: 40BED670-8B91-4520-9785-DB1F1035C039
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Device Start End Sectors Size Type
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/dev/sda1 &lt;span style="color:#ae81ff">2048&lt;/span> &lt;span style="color:#ae81ff">1050623&lt;/span> &lt;span style="color:#ae81ff">1048576&lt;/span> 512M EFI System
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/dev/sda2 &lt;span style="color:#ae81ff">1050624&lt;/span> &lt;span style="color:#ae81ff">207714303&lt;/span> &lt;span style="color:#ae81ff">206663680&lt;/span> 98.5G Linux filesystem
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/dev/sda3 &lt;span style="color:#ae81ff">207714304&lt;/span> &lt;span style="color:#ae81ff">209713151&lt;/span> &lt;span style="color:#ae81ff">1998848&lt;/span> 976M Linux swap
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>➜ ~ df -hT /dev/sda2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Filesystem Type Size Used Avail Use% Mounted on
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/dev/sda2 ext4 97G 28G 64G 31% /
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="删除分区-devsda3">
 删除分区 &lt;code>/dev/sda3&lt;/code>
 &lt;a class="anchor" href="#%e5%88%a0%e9%99%a4%e5%88%86%e5%8c%ba-devsda3">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>➜ ~ fdisk /dev/sda
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Welcome to fdisk &lt;span style="color:#f92672">(&lt;/span>util-linux 2.36.1&lt;span style="color:#f92672">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Changes will remain in memory only, &lt;span style="color:#66d9ef">until&lt;/span> you decide to write them.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Be careful before using the write command.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Command &lt;span style="color:#f92672">(&lt;/span>m &lt;span style="color:#66d9ef">for&lt;/span> help&lt;span style="color:#f92672">)&lt;/span>: d
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Partition number &lt;span style="color:#f92672">(&lt;/span>1-3, default 3&lt;span style="color:#f92672">)&lt;/span>: &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Partition &lt;span style="color:#ae81ff">3&lt;/span> has been deleted.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Command &lt;span style="color:#f92672">(&lt;/span>m &lt;span style="color:#66d9ef">for&lt;/span> help&lt;span style="color:#f92672">)&lt;/span>: p
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disk /dev/sda: &lt;span style="color:#ae81ff">100&lt;/span> GiB, &lt;span style="color:#ae81ff">107374182400&lt;/span> bytes, &lt;span style="color:#ae81ff">209715200&lt;/span> sectors
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disk model: BlockVolume 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Units: sectors of &lt;span style="color:#ae81ff">1&lt;/span> * 512 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">512&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Sector size &lt;span style="color:#f92672">(&lt;/span>logical/physical&lt;span style="color:#f92672">)&lt;/span>: &lt;span style="color:#ae81ff">512&lt;/span> bytes / &lt;span style="color:#ae81ff">4096&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>I/O size &lt;span style="color:#f92672">(&lt;/span>minimum/optimal&lt;span style="color:#f92672">)&lt;/span>: &lt;span style="color:#ae81ff">4096&lt;/span> bytes / &lt;span style="color:#ae81ff">1048576&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disklabel type: gpt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Disk identifier: 40BED670-8B91-4520-9785-DB1F1035C039
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Device Start End Sectors Size Type
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/dev/sda1 &lt;span style="color:#ae81ff">2048&lt;/span> &lt;span style="color:#ae81ff">1050623&lt;/span> &lt;span style="color:#ae81ff">1048576&lt;/span> 512M EFI System
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/dev/sda2 &lt;span style="color:#ae81ff">1050624&lt;/span> &lt;span style="color:#ae81ff">207714303&lt;/span> &lt;span style="color:#ae81ff">206663680&lt;/span> 98.5G Linux filesystem
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Command &lt;span style="color:#f92672">(&lt;/span>m &lt;span style="color:#66d9ef">for&lt;/span> help&lt;span style="color:#f92672">)&lt;/span>: w &lt;span style="color:#75715e"># 保存退出&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>The partition table has been altered.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Syncing disks.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="扩容分区-devsda2-和-根文件系统">
 扩容分区 &lt;code>/dev/sda2&lt;/code> 和 根文件系统
 &lt;a class="anchor" href="#%e6%89%a9%e5%ae%b9%e5%88%86%e5%8c%ba-devsda2-%e5%92%8c-%e6%a0%b9%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f">#&lt;/a>
&lt;/h2>
&lt;p>使用 &lt;code>fdisk&lt;/code> 扩容 &lt;code>/dev/sda2&lt;/code>, 前提是 &lt;code>/dev/sda2&lt;/code> 后面没有其他分区了，可以这样扩容(先删除不退出并重建分区, 分区 &lt;code>Start&lt;/code> 不变, &lt;code>End&lt;/code> 增大)&lt;/p></description></item></channel></rss>