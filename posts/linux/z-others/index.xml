<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>其他 on gobai's blog</title><link>/posts/linux/z-others/</link><description>Recent content in 其他 on gobai's blog</description><generator>Hugo</generator><language>en-us</language><atom:link href="/posts/linux/z-others/index.xml" rel="self" type="application/rss+xml"/><item><title>Shell Script</title><link>/posts/shell-script/</link><pubDate>Sat, 23 Mar 2024 09:43:34 +0800</pubDate><guid>/posts/shell-script/</guid><description>&lt;blockquote>
&lt;p>最近写的shell脚本比较多，记录一些常用命令, 相当于记录一个索引, 以后用时可以快速回忆起来.&lt;/p>&lt;/blockquote>
&lt;h2 id="binbash">
 &lt;code>#!/bin/bash&lt;/code>
 &lt;a class="anchor" href="#binbash">#&lt;/a>
&lt;/h2>
&lt;p>&lt;code>#!/bin/bash&lt;/code>被称为&lt;code>shebang line&lt;/code>, 指定执行此脚本文件时使用&lt;code>/bin/bash&lt;/code>做为shell解释器程序&lt;/p>
&lt;p>很多主流操作系统默认的shell解释器也是bash&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># echo $SHELL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/bin/bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="set">
 &lt;code>set&lt;/code>
 &lt;a class="anchor" href="#set">#&lt;/a>
&lt;/h2>
&lt;p>&lt;code>set&lt;/code>命令用来修改shell环境的运行参数, 完整的可定制的&lt;a href="https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html">官方手册&lt;/a>&lt;/p>
&lt;p>下面是我常用的几个, 可以合并为如下内容写在脚本开头:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>set -uxe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>set -o pipefail
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="set--u">
 &lt;code>set -u&lt;/code>
 &lt;a class="anchor" href="#set--u">#&lt;/a>
&lt;/h3>
&lt;p>执行脚本时, 如果遇到不存在的变量, Bash默认会忽略, &lt;code>set -u&lt;/code>可以让脚本读到不存在变量时报错&lt;/p>
&lt;h3 id="set--x">
 &lt;code>set -x&lt;/code>
 &lt;a class="anchor" href="#set--x">#&lt;/a>
&lt;/h3>
&lt;p>命令执行前会先打印出来, 行首以&lt;code>+&lt;/code>表示, 在调试脚本时非常有帮助&lt;/p>
&lt;h3 id="set--e">
 &lt;code>set -e&lt;/code>
 &lt;a class="anchor" href="#set--e">#&lt;/a>
&lt;/h3>
&lt;p>执行脚本时, Bash遇到错误默认会继续执行, &lt;code>set -e&lt;/code>使得脚本只要发生错误, 就中止执行&lt;/p>
&lt;h3 id="set--o-pipefail">
 &lt;code>set -o pipefail&lt;/code>
 &lt;a class="anchor" href="#set--o-pipefail">#&lt;/a>
&lt;/h3>
&lt;p>&lt;code>set -e&lt;/code>有一个例外情况, 就是不适用于管道命令, 比如下面的不会退出&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>set -e
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>foo | echo a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo bar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>执行的结果为:&lt;/p></description></item><item><title>Ubuntu Config</title><link>/posts/ubuntu-config/</link><pubDate>Sun, 24 Sep 2023 10:56:12 +0800</pubDate><guid>/posts/ubuntu-config/</guid><description>&lt;blockquote>
&lt;p>以下配置都是在 &lt;code>Ubuntu 22.04&lt;/code> 系统配置&lt;/p>&lt;/blockquote>
&lt;h2 id="配置中文输入法">
 配置中文输入法
 &lt;a class="anchor" href="#%e9%85%8d%e7%bd%ae%e4%b8%ad%e6%96%87%e8%be%93%e5%85%a5%e6%b3%95">#&lt;/a>
&lt;/h2>
&lt;ol>
&lt;li>Open Settings, go to &lt;code>Region &amp;amp; Language&lt;/code> -&amp;gt; &lt;code>Manage Installed Languages&lt;/code> -&amp;gt; &lt;code>Install / Remove languages&lt;/code>.&lt;/li>
&lt;li>Select &lt;code>Chinese (Simplified)&lt;/code>. Make sure &lt;code>Keyboard Input method system&lt;/code> has &lt;code>Ibus&lt;/code> selected. Apply.&lt;/li>
&lt;li>Reboot&lt;/li>
&lt;li>Log back in, reopen Settings, go to &lt;code>Keyboard&lt;/code>.&lt;/li>
&lt;li>Click on the &amp;ldquo;+&amp;rdquo; sign under &lt;code>Input sources&lt;/code>.&lt;/li>
&lt;li>Select &lt;code>Chinese (China)&lt;/code> and then &lt;code>Chinese (Intelligent Pinyin)&lt;/code>.&lt;/li>
&lt;/ol>
&lt;p>&lt;a href="https://askubuntu.com/questions/1408873/ubuntu-22-04-chinese-simplified-pinyin-input-support">ubuntu-22-04-chinese-simplified-pinyin-input-support&lt;/a>&lt;/p>
&lt;h2 id="修正简体中文显示为异体日文字形">
 修正简体中文显示为异体(日文)字形
 &lt;a class="anchor" href="#%e4%bf%ae%e6%ad%a3%e7%ae%80%e4%bd%93%e4%b8%ad%e6%96%87%e6%98%be%e7%a4%ba%e4%b8%ba%e5%bc%82%e4%bd%93%e6%97%a5%e6%96%87%e5%ad%97%e5%bd%a2">#&lt;/a>
&lt;/h2>
&lt;blockquote>
&lt;p>ubuntu/linux对中文支持的不太好, 在选择汉字字体时, 优先选择的是日文或者韩文, 需要手动调整优先级后重启操作系统解决&lt;/p></description></item><item><title>About Systemd</title><link>/posts/systemd-journal/</link><pubDate>Sun, 14 Nov 2021 01:47:04 +0800</pubDate><guid>/posts/systemd-journal/</guid><description>&lt;p>记录一下查看和操作 &lt;code>systemd&lt;/code> 日志的几个常用命令&lt;/p>
&lt;h2 id="常用过滤日志日志的命令">
 常用过滤日志日志的命令
 &lt;a class="anchor" href="#%e5%b8%b8%e7%94%a8%e8%bf%87%e6%bb%a4%e6%97%a5%e5%bf%97%e6%97%a5%e5%bf%97%e7%9a%84%e5%91%bd%e4%bb%a4">#&lt;/a>
&lt;/h2>
&lt;h3 id="根据时间约束过滤日志">
 根据时间约束过滤日志
 &lt;a class="anchor" href="#%e6%a0%b9%e6%8d%ae%e6%97%b6%e9%97%b4%e7%ba%a6%e6%9d%9f%e8%bf%87%e6%bb%a4%e6%97%a5%e5%bf%97">#&lt;/a>
&lt;/h3>
&lt;h4 id="获取-2023-01-15-000000-之后的日志">
 获取 &lt;code>2023-01-15 00:00:00&lt;/code> 之后的日志
 &lt;a class="anchor" href="#%e8%8e%b7%e5%8f%96-2023-01-15-000000-%e4%b9%8b%e5%90%8e%e7%9a%84%e6%97%a5%e5%bf%97">#&lt;/a>
&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>journalctl --since &lt;span style="color:#e6db74">&amp;#39;2023-01-15 00:00:00&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="获取-2023-01-15-000000-之后-2023-01-15-120000-之前的日志">
 获取 &lt;code>2023-01-15 00:00:00&lt;/code> 之后, &lt;code>2023-01-15 12:00:00&lt;/code> 之前的日志
 &lt;a class="anchor" href="#%e8%8e%b7%e5%8f%96-2023-01-15-000000-%e4%b9%8b%e5%90%8e-2023-01-15-120000-%e4%b9%8b%e5%89%8d%e7%9a%84%e6%97%a5%e5%bf%97">#&lt;/a>
&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>journalctl --since &lt;span style="color:#e6db74">&amp;#39;2023-01-15 00:00:00&amp;#39;&lt;/span> --until &lt;span style="color:#e6db74">&amp;#39;2023-01-15 12:00:00&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="只查看一个服务unit的日志">
 只查看一个服务(Unit)的日志
 &lt;a class="anchor" href="#%e5%8f%aa%e6%9f%a5%e7%9c%8b%e4%b8%80%e4%b8%aa%e6%9c%8d%e5%8a%a1unit%e7%9a%84%e6%97%a5%e5%bf%97">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>journalctl -u nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="自由组合约束条件">
 自由组合约束条件
 &lt;a class="anchor" href="#%e8%87%aa%e7%94%b1%e7%bb%84%e5%90%88%e7%ba%a6%e6%9d%9f%e6%9d%a1%e4%bb%b6">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>journalctl -u nginx --since &lt;span style="color:#e6db74">&amp;#39;2023-01-15 00:00:00&amp;#39;&lt;/span> --until &lt;span style="color:#e6db74">&amp;#39;2023-01-15 12:00:00&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看日志占用磁盘量">
 查看日志占用磁盘量
 &lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8b%e6%97%a5%e5%bf%97%e5%8d%a0%e7%94%a8%e7%a3%81%e7%9b%98%e9%87%8f">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>journalctl --disk-usage
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>Output
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Archived and active journals take up 3.9G in the file system.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="删除旧的日志">
 删除旧的日志
 &lt;a class="anchor" href="#%e5%88%a0%e9%99%a4%e6%97%a7%e7%9a%84%e6%97%a5%e5%bf%97">#&lt;/a>
&lt;/h2>
&lt;h3 id="只保留最近-一个月-的日志">
 只保留最近 &lt;code>一个月&lt;/code> 的日志
 &lt;a class="anchor" href="#%e5%8f%aa%e4%bf%9d%e7%95%99%e6%9c%80%e8%bf%91-%e4%b8%80%e4%b8%aa%e6%9c%88-%e7%9a%84%e6%97%a5%e5%bf%97">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>journalctl --vacuum-time&lt;span style="color:#f92672">=&lt;/span>1month
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="只保留最近-1g-的日志">
 只保留最近 &lt;code>1G&lt;/code> 的日志
 &lt;a class="anchor" href="#%e5%8f%aa%e4%bf%9d%e7%95%99%e6%9c%80%e8%bf%91-1g-%e7%9a%84%e6%97%a5%e5%bf%97">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>journalctl --vacuum-size&lt;span style="color:#f92672">=&lt;/span>1G
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="列出所有systemd服务">
 列出所有systemd服务
 &lt;a class="anchor" href="#%e5%88%97%e5%87%ba%e6%89%80%e6%9c%89systemd%e6%9c%8d%e5%8a%a1">#&lt;/a>
&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>systemctl list-units --type&lt;span style="color:#f92672">=&lt;/span>service --all
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>