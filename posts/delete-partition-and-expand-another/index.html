<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>删除分区并扩容另一个分区和根文件系统 | gobai's blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/xcode.min.css rel=stylesheet></head><body><nav><ul class=menu><li><a href=/>Home</a></li><li><a href=/about/>About</a></li><li><a href=/tags/>Tags</a></li><li><a href=/index.xml>Subscribe</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>删除分区并扩容另一个分区和根文件系统</span></h1><h4 class=date>2023/10/02</h4><p class=terms>Tags: <a href=/tags/linux>linux</a> <a href=/tags/fdisk>fdisk</a> <a href=/tags/resize2fs>resize2fs</a> <a href=/tags/lsblk>lsblk</a> <a href=/tags/partprobe>partprobe</a> <a href=/tags/ext4>ext4</a> <a href=/tags/partition>partition</a></p></div><main><blockquote><p>现在要将 <code>/dev/sda3</code> 分区删掉并扩容到 <code>/dev/sda2</code>, 并且在不重启服务器的情况下扩容根文件系统(跟文件系统 <code>/</code> 挂载在 <code>/dev/sda2</code> 上, 并且 filesystem 是 <code>ext4</code>)</p></blockquote><h3 id=磁盘初始分区和挂载情况>磁盘初始分区和挂载情况</h3><pre><code class=language-bash>➜  ~ lsblk /dev/sda
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0  100G  0 disk 
├─sda1   8:1    0  512M  0 part /boot/efi
├─sda2   8:2    0 98.5G  0 part /
└─sda3   8:3    0  976M  0 part 

➜  ~ fdisk -l /dev/sda
Disk /dev/sda: 100 GiB, 107374182400 bytes, 209715200 sectors
Disk model: BlockVolume     
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 1048576 bytes
Disklabel type: gpt
Disk identifier: 40BED670-8B91-4520-9785-DB1F1035C039

Device         Start       End   Sectors  Size Type
/dev/sda1       2048   1050623   1048576  512M EFI System
/dev/sda2    1050624 207714303 206663680 98.5G Linux filesystem
/dev/sda3  207714304 209713151   1998848  976M Linux swap

➜  ~ df -hT /dev/sda2
Filesystem     Type  Size  Used Avail Use% Mounted on
/dev/sda2      ext4   97G   28G   64G  31% /
</code></pre><h3 id=删除分区-devsda3>删除分区 <code>/dev/sda3</code></h3><pre><code class=language-bash>➜  ~ fdisk /dev/sda

Welcome to fdisk (util-linux 2.36.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): d
Partition number (1-3, default 3): 3

Partition 3 has been deleted.

Command (m for help): p
Disk /dev/sda: 100 GiB, 107374182400 bytes, 209715200 sectors
Disk model: BlockVolume     
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 1048576 bytes
Disklabel type: gpt
Disk identifier: 40BED670-8B91-4520-9785-DB1F1035C039

Device       Start       End   Sectors  Size Type
/dev/sda1     2048   1050623   1048576  512M EFI System
/dev/sda2  1050624 207714303 206663680 98.5G Linux filesystem

Command (m for help): w # 保存退出
The partition table has been altered.
Syncing disks.
</code></pre><h3 id=扩容分区-devsda2-和-根文件系统>扩容分区 <code>/dev/sda2</code> 和 根文件系统</h3><p>使用 <code>fdisk</code> 扩容 <code>/dev/sda2</code>, 前提是 <code>/dev/sda2</code> 后面没有其他分区了，可以这样扩容(先删除不退出并重建分区, 分区 <code>Start</code> 不变, <code>End</code> 增大)</p><pre><code class=language-bash>➜  ~ fdisk /dev/sda

Welcome to fdisk (util-linux 2.36.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): p
Disk /dev/sda: 100 GiB, 107374182400 bytes, 209715200 sectors
Disk model: BlockVolume     
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 1048576 bytes
Disklabel type: gpt
Disk identifier: 40BED670-8B91-4520-9785-DB1F1035C039

Device       Start       End   Sectors  Size Type
/dev/sda1     2048   1050623   1048576  512M EFI System
/dev/sda2  1050624 207714303 206663680 98.5G Linux filesystem

Command (m for help): d # 删除第二个分区, 不要保存退出, 退出就凉了
Partition number (1,2, default 2): 2

Partition 2 has been deleted.

Command (m for help): p
Disk /dev/sda: 100 GiB, 107374182400 bytes, 209715200 sectors
Disk model: BlockVolume     
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 1048576 bytes
Disklabel type: gpt
Disk identifier: 40BED670-8B91-4520-9785-DB1F1035C039

Device     Start     End Sectors  Size Type
/dev/sda1   2048 1050623 1048576  512M EFI System

Command (m for help): n # 紧接着重新创建
Partition number (2-128, default 2): 2 # 因为使用的是GPT分区表, 所以最多可以有128个分区, MBR的只能有4个分区
First sector (1050624-209715166, default 1050624): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (1050624-209715166, default 209715166): 

Created a new partition 2 of type 'Linux filesystem' and of size 99.5 GiB.
Partition #2 contains a ext4 signature.

Do you want to remove the signature? [Y]es/[N]o: N

Command (m for help): p

Disk /dev/sda: 100 GiB, 107374182400 bytes, 209715200 sectors
Disk model: BlockVolume     
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 1048576 bytes
Disklabel type: gpt
Disk identifier: 40BED670-8B91-4520-9785-DB1F1035C039

Device       Start       End   Sectors  Size Type
/dev/sda1     2048   1050623   1048576  512M EFI System
/dev/sda2  1050624 209715166 208664543 99.5G Linux filesystem

Command (m for help): w # 保存退出
The partition table has been altered.
Syncing disks.
</code></pre><p>reload partition table</p><pre><code class=language-bash>apt install parted -y
partprobe /dev/sda
</code></pre><p>resize文件系统</p><pre><code class=language-bash>➜  ~ resize2fs /dev/sda2
resize2fs 1.46.2 (28-Feb-2021)
Filesystem at /dev/sda2 is mounted on /; on-line resizing required
old_desc_blocks = 13, new_desc_blocks = 13
The filesystem on /dev/sda2 is now 26083067 (4k) blocks long.

➜  ~ df -hT /dev/sda2
Filesystem     Type  Size  Used Avail Use% Mounted on
/dev/sda2      ext4   98G   28G   65G  31% /
</code></pre><p>至此, 在不重启的情况下 <code>/</code> 目录的容量从最初的 <code>97G</code> 变成了 <code>98G</code> 👏</p><h4 id=参考>参考</h4><ul><li><a href=https://askubuntu.com/questions/24027/how-can-i-resize-an-ext-root-partition-at-runtime>How can I resize an ext root partition at runtime?</a></li><li><a href=https://www.cyberciti.biz/tips/re-read-the-partition-table-without-rebooting-linux-system.html>Re-read The Partition Table Without Rebooting Linux System</a></li><li><a href=https://cloud-atlas.readthedocs.io/zh_CN/latest/linux/storage/filesystem/ext/resize_ext4_rootfs.html#ext4>调整ext4根文件系统大小</a></li></ul></main><footer><script defer src=https://cdn.jsdelivr.net/npm/@xiee/utils/js/center-img.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script>
<script>hljs.configure({languages:[]}),hljs.highlightAll()</script><hr>© <a href=https://blog.gocn.top>gobai</a> 2021 &ndash; 2023 | <a href=https://github.com/go-bai>Github</a></footer></body></html>