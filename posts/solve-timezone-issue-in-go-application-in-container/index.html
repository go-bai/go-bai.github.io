<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>è§£å†³Goåº”ç”¨åœ¨å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜ | gobai's blog</title>
<link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/xcode.min.css rel=stylesheet></head><body><nav><ul class=menu><li><a href=/>Home</a></li><li><a href=/about/>About</a></li><li><a href=/tags/>Tags</a></li><li><a href=/index.xml>Subscribe</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>è§£å†³Goåº”ç”¨åœ¨å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜</span></h1><h4 class=date>2023/02/18</h4><p class=terms>Tags: <a href=/tags/golang>golang</a> <a href=/tags/docker>docker</a> <a href=/tags/container>container</a> <a href=/tags/timezone>timezone</a></p></div><main><h2 id=å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜>å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜</h2><p>åº”ç”¨ç›´æ¥è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šéœ€è¦è®¾ç½®æœåŠ¡å™¨æ—¶åŒºä¸ºä¸œå…«åŒºï¼Œç°åœ¨å¾ˆå¤šåº”ç”¨éƒ½æ˜¯éƒ¨ç½²åœ¨å®¹å™¨ä¸­äº†ï¼ŒåŒæ ·ä¹Ÿæ˜¯è¦è®¾ç½®å®¹å™¨é•œåƒçš„æ—¶åŒºã€‚</p><p>è®¸å¤šå®¹å™¨é•œåƒé»˜è®¤æ—¶åŒºä¸º <code>UTC</code> (<a href=https://zh.wikipedia.org/zh-hans/%E5%8D%8F%E8%B0%83%E4%B8%96%E7%95%8C%E6%97%B6>Coordinated Universal Time åè°ƒä¸–ç•Œæ—¶</a>)ï¼Œæ¯”ä¸œå…«åŒºæ…¢å…«ä¸ªå°æ—¶ï¼Œå½“ç¨‹åºæ¶‰åŠæ•°æ®åº“å†™å…¥æ“ä½œæˆ–è€…æ—¥å¿—è®°å½•ç­‰åŠŸèƒ½æ—¶å°±ä¼šæœ‰æ—¶é—´å·®ã€‚</p><p>å¸¸è§„è§£å†³æ–¹æ¡ˆä¸€èˆ¬ä¸¤å¤§ç±»</p><ol><li>build dockeré•œåƒæ—¶å°±æŠŠé•œåƒå†…çš„æ—¶åŒºè®¾ç½®ä¸º <code>Asia/Shanghai</code></li><li>è¿è¡Œå®¹å™¨æ—¶æŠŠæœ¬åœ°æ—¶åŒºæ­£å¸¸çš„ä¸»æœºçš„æ—¶åŒºé…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ã€‚</li></ol><h3 id=çœ‹ä¸€ä¸‹-go-æ˜¯å¦‚ä½•è¯»å–æ—¶åŒºæ–‡ä»¶å¹¶è®¾ç½®-timetime-çš„æ—¶åŒºçš„>çœ‹ä¸€ä¸‹ <code>Go</code> æ˜¯å¦‚ä½•è¯»å–æ—¶åŒºæ–‡ä»¶å¹¶è®¾ç½® <code>time.Time</code> çš„æ—¶åŒºçš„</h3><p><code>Go</code> æºç  <a href=https://github.com/golang/go/blob/master/src/time/zoneinfo_unix.go>src/time/zoneinfo_unix.go</a> ä¸­ä»£ç å’Œæ³¨é‡Šéƒ½å¾ˆæ¸…æ™°ğŸ‘</p><pre><code class=language-golang>package time

import (
    &quot;syscall&quot;
)

// Many systems use /usr/share/zoneinfo, Solaris 2 has
// /usr/share/lib/zoneinfo, IRIX 6 has /usr/lib/locale/TZ,
// NixOS has /etc/zoneinfo.
var platformZoneSources = []string{
    &quot;/usr/share/zoneinfo/&quot;,
    &quot;/usr/share/lib/zoneinfo/&quot;,
    &quot;/usr/lib/locale/TZ/&quot;,
    &quot;/etc/zoneinfo&quot;,
}

func initLocal() {
    // consult $TZ to find the time zone to use.
    // no $TZ means use the system default /etc/localtime.
    // $TZ=&quot;&quot; means use UTC.
    // $TZ=&quot;foo&quot; or $TZ=&quot;:foo&quot; if foo is an absolute path, then the file pointed
    // by foo will be used to initialize timezone; otherwise, file
    // /usr/share/zoneinfo/foo will be used.

    tz, ok := syscall.Getenv(&quot;TZ&quot;)
    switch {
    case !ok:
        z, err := loadLocation(&quot;localtime&quot;, []string{&quot;/etc&quot;})
        if err == nil {
            localLoc = *z
            localLoc.name = &quot;Local&quot;
            return
        }
    case tz != &quot;&quot;:
        if tz[0] == ':' {
            tz = tz[1:]
        }
        if tz != &quot;&quot; &amp;&amp; tz[0] == '/' {
            if z, err := loadLocation(tz, []string{&quot;&quot;}); err == nil {
                localLoc = *z
                if tz == &quot;/etc/localtime&quot; {
                    localLoc.name = &quot;Local&quot;
                } else {
                    localLoc.name = tz
                }
                return
            }
        } else if tz != &quot;&quot; &amp;&amp; tz != &quot;UTC&quot; {
            if z, err := loadLocation(tz, platformZoneSources); err == nil {
                localLoc = *z
                return
            }
        }
    }

    // Fall back to UTC.
    localLoc.name = &quot;UTC&quot;
}
</code></pre><p>é¦–å…ˆæ£€æŸ¥æ˜¯å¦è®¾ç½®äº† <code>TZ</code> ç¯å¢ƒå˜é‡</p><ul><li>è®¾ç½®äº† <code>TZ</code><ul><li><code>TZ</code> ä¸ºç©º<ul><li>åˆ™æ—¶åŒºè¿˜æ˜¯ <code>UTC</code></li></ul></li><li><code>TZ</code> ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º <code>:</code><ul><li>å»æ‰ <code>:</code></li></ul></li><li><code>TZ</code> ä¸ä¸ºç©ºä¸”ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º <code>/</code><ul><li>ä» <code>TZ</code> è®¾ç½®çš„è·¯å¾„ä¸­åŠ è½½æ—¶åŒºæ–‡ä»¶å¹¶è®¾ç½®æ—¶åŒº</li><li>å¦‚æœæ²¡åŠ è½½åˆ°æ—¶åŒºæ–‡ä»¶ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿˜æ˜¯ <code>UTC</code> æ—¶åŒºã€‚</li></ul></li><li><code>TZ</code> ä¸ä¸ºç©ºä¸”ä¸æ˜¯ <code>UTC</code><ul><li>ä» <code>platformZoneSources</code> ä¸­çš„å‡ ä¸ªè·¯å¾„ä¸‹ä¸­åŠ è½½ <code>TZ</code> æŒ‡å®šçš„æ—¶åŒºæ–‡ä»¶å¹¶è®¾ç½®æ—¶åŒº</li><li>å¦‚æœæ²¡åŠ è½½åˆ°æ—¶åŒºæ–‡ä»¶ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿˜æ˜¯ <code>UTC</code> æ—¶åŒºã€‚</li></ul></li></ul></li><li>æ²¡è®¾ç½® <code>TZ</code><ul><li>åŠ è½½ <code>/etc/localtime</code> æ—¶åŒºæ–‡ä»¶</li><li>å¦‚æœæ²¡åŠ è½½åˆ°æ—¶åŒºæ–‡ä»¶ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿˜æ˜¯ <code>UTC</code> æ—¶åŒºã€‚</li></ul></li></ul><p>ç»¼ä¸Šï¼Œåœ¨ <code>Dockerfile</code> ä¸­å¯ä»¥ç”¨ä¸‹é¢ä¸¤ç§æ–¹å¼ä¹‹ä¸€æ­£ç¡®è®¾ç½®æ—¶åŒº</p><ol><li>è®¾ç½® <code>TZ</code> ä¸º <code>Asia/Shanghai</code></li><li>ä¸è®¾ç½® <code>TZ</code>ï¼Œå°† <code>/usr/share/zoneinfo/Asia/Shanghai</code> æ‹·è´æˆ–è½¯é“¾åˆ° <code>/etc/localtime</code></li></ol><p>ä¸Šé¢ä¸¤ç§æ–¹å¼éƒ½éœ€è¦æœ‰ <code>/usr/share/zoneinfo/Asia/Shanghai</code> æ—¶åŒºæ–‡ä»¶ã€‚</p></main><footer><script defer src=https://cdn.jsdelivr.net/npm/@xiee/utils/js/center-img.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script>hljs.configure({languages:[]}),hljs.highlightAll()</script><hr>Â© <a href=https://blog.gocn.top>gobai</a> 2021 &ndash; 2024 | <a href=https://github.com/go-bai>Github</a></footer></body></html>