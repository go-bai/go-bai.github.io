<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Prometheus on gobai's blog</title><link>/tags/prometheus/</link><description>Recent content in Prometheus on gobai's blog</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Wed, 03 Jul 2024 22:39:59 +0800</lastBuildDate><atom:link href="/tags/prometheus/index.xml" rel="self" type="application/rss+xml"/><item><title>Node Exporter</title><link>/posts/node-exporter/</link><pubDate>Wed, 03 Jul 2024 22:39:59 +0800</pubDate><guid>/posts/node-exporter/</guid><description>&lt;h2 id="node-exporter-安装">node-exporter 安装&lt;/h2>
&lt;h3 id="生成账号密码的-bcrypt-hash">生成账号密码的 bcrypt hash&lt;/h3>
&lt;pre>&lt;code class="language-bash">apt install apache2-utils -y
&lt;/code>&lt;/pre>
&lt;p>生成一个账号密码的 bcrypt hash&lt;/p>
&lt;ul>
&lt;li>&lt;code>-B&lt;/code> 强制使用 bcrypt 算法&lt;/li>
&lt;li>&lt;code>-C 10&lt;/code> 指定 bcrypt 的 cost 值为 10, golang bcrypt 默认 cost 值也为 10&lt;/li>
&lt;/ul>
&lt;p>注意修改下面的 &lt;code>username&lt;/code> 和 &lt;code>password&lt;/code> 为你要设置的账号密码&lt;/p>
&lt;pre>&lt;code class="language-bash"># htpasswd -nbBC 10 username password
username:$2y$10$poDYDLemE3r95gcQ.h8FdODudFaFZhwZCSX1RTwpI2s8V4Mwm0.lO
&lt;/code>&lt;/pre>
&lt;h4 id="关于-bcrypt">关于 bcrypt&lt;/h4>
&lt;p>格式为 &lt;code>$2&amp;lt;a/b/x/y&amp;gt;$[cost]$[22 character salt][31 character hash]&lt;/code>&lt;/p>
&lt;p>例如&lt;/p>
&lt;pre>&lt;code class="language-bash">$2y$10$poDYDLemE3r95gcQ.h8FdODudFaFZhwZCSX1RTwpI2s8V4Mwm0.lO
\__/\/ \____________________/\_____________________________/
Alg Cost Salt Hash
&lt;/code>&lt;/pre>
&lt;h3 id="运行-node-exporter">运行 node-exporter&lt;/h3>
&lt;ol>
&lt;li>创建 &lt;code>prometheus&lt;/code> 配置文件 &lt;code>/etc/prometheus/web.yml&lt;/code>&lt;/li>
&lt;li>创建 &lt;code>docker-compose.yml&lt;/code> 文件&lt;/li>
&lt;li>运行 docker compose&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-bash">PASS='$2y$10$poDYDLemE3r95gcQ.h8FdODudFaFZhwZCSX1RTwpI2s8V4Mwm0.lO'
mkdir -p /etc/prometheus

cat &amp;lt;&amp;lt;EOF&amp;gt; /etc/prometheus/web.yml
basic_auth_users:
 # username: password
 prometheus: ${PASS}
EOF

cat &amp;lt;&amp;lt;EOF&amp;gt; /etc/prometheus/docker-compose.yml
services:
 node-exporter:
 image: quay.io/prometheus/node-exporter:latest
 container_name: node-exporter
 command: 
 - &amp;quot;--path.rootfs=/host&amp;quot;
 - &amp;quot;--web.config.file=/etc/prometheus/web.yml&amp;quot;
 network_mode: &amp;quot;host&amp;quot;
 pid: host
 restart: always
 volumes:
 - '/:/host:ro,rslave'
 - /etc/prometheus/web.yml:/etc/prometheus/web.yml
EOF

docker compose -f /etc/prometheus/docker-compose.yml up -d
&lt;/code>&lt;/pre>
&lt;h2 id="修改-kube-prometheus-stack-chart-配置">修改 kube-prometheus-stack chart 配置&lt;/h2>
&lt;p>修改 &lt;code>kube-prometheus-stack&lt;/code> chart 配置并更新, 记得修改 &lt;code>{EDIT_HERE}&lt;/code> 为实际值&lt;/p></description></item></channel></rss>