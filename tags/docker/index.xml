<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Docker on gobai's blog</title><link>/tags/docker/</link><description>Recent content in Docker on gobai's blog</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Sun, 13 Oct 2024 11:27:56 +0800</lastBuildDate><atom:link href="/tags/docker/index.xml" rel="self" type="application/rss+xml"/><item><title>æ„å»ºå¤šå¹³å°å®¹å™¨é•œåƒ</title><link>/posts/builing-multi-platform-container-images-guide/</link><pubDate>Sun, 13 Oct 2024 11:27:56 +0800</pubDate><guid>/posts/builing-multi-platform-container-images-guide/</guid><description>&lt;blockquote>
&lt;p>æ„å»ºå¤šå¹³å°å®¹å™¨é•œåƒ&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker-buildx-æ’ä»¶å­å‘½ä»¤">Docker buildx æ’ä»¶/å­å‘½ä»¤&lt;/h2>
&lt;p>&lt;a href="https://github.com/docker/buildx">buildx&lt;/a> æ˜¯ Docker çš„ä¸€ä¸ª CLI æ’ä»¶ï¼Œç”¨äºæ‰©å±•æ¥è‡ªäº &lt;a href="https://github.com/moby/buildkit">Moby BuildKit&lt;/a> é¡¹ç›®çš„æ„å»ºåŠŸèƒ½ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼šbuildx éœ€è¦ Docker 19.03 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚&lt;/p>
&lt;h2 id="buildkit">BuildKit&lt;/h2>
&lt;p>BuildKitæ˜¯ä¸€ä¸ªbuildå¼•æ“ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ˆDockerfileï¼‰ï¼Œå¹¶è½¬åŒ–æˆä¸€ä¸ªåˆ¶å“ï¼ˆå®¹å™¨é•œåƒæˆ–å…¶ä»–åˆ¶å“ï¼‰ã€‚ç›¸è¾ƒä¸ä¼ ç»Ÿçš„buildå…·æœ‰å¤šé˜¶æ®µå¹¶å‘æ„å»ºã€æ›´å¥½çš„layerç¼“å­˜æ”¯æŒç­‰ä¼˜ç‚¹ï¼ŒDockerfileä¸­çš„RUNæŒ‡ä»¤ä¼šè¢«runcæ‰§è¡Œã€‚&lt;/p>
&lt;p>Docker Engine ä» &lt;a href="https://docs.docker.com/engine/release-notes/23.0/#2300">23.0.0&lt;/a> ç‰ˆæœ¬å¼€å§‹é»˜è®¤åœ¨Linuxä¸Šä½¿ç”¨Buildxå’ŒBuildKitä¸ºbuilderã€‚&lt;/p>
&lt;h3 id="builder-a-buildkit-daemon">Builder: a BuildKit daemon&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/build/builders/">Buildersä»‹ç»&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ä¸€ä¸ª builder æ˜¯ä¸€ä¸ª BuildKit å®ˆæŠ¤è¿›ç¨‹ï¼ŒBuildKitæ˜¯buildå¼•æ“ï¼Œå®ƒè§£å†³Dockerfileä¸­çš„æ„å»ºæ­¥éª¤ï¼Œä»¥ç”Ÿæˆå®¹å™¨é•œåƒæˆ–å…¶ä»–åˆ¶å“ã€‚&lt;/p>
&lt;h3 id="build-drivers">Build drivers&lt;/h3>
&lt;p>Build é©±åŠ¨æœ‰å¤šç§ï¼Œä¾‹å¦‚ &lt;code>docker&lt;/code>ã€&lt;code>docker-container&lt;/code>ã€&lt;code>kubernetes&lt;/code>ã€&lt;code>remote&lt;/code> ç­‰ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>docker&lt;/code> ä½¿ç”¨æ†ç»‘åœ¨Dockerå®ˆæŠ¤è¿›ç¨‹ä¸­çš„BuildKitåº“ã€‚é»˜è®¤çš„Builderä½¿ç”¨çš„è¯¥é©±åŠ¨ã€‚&lt;/li>
&lt;li>&lt;code>docker-container&lt;/code> ä½¿ç”¨Dockeråˆ›å»ºä¸€ä¸ªä¸“ç”¨çš„BuildKitå®¹å™¨ã€‚&lt;/li>
&lt;li>&lt;code>kubernetes&lt;/code> åœ¨Kubernetesé›†ç¾¤ä¸­åˆ›å»ºBuildKit podsã€‚&lt;/li>
&lt;li>&lt;code>remote&lt;/code> ç›´æ¥è¿æ¥åˆ°æ‰‹åŠ¨ç®¡ç†çš„BuildKitå®ˆæŠ¤è¿›ç¨‹ã€‚&lt;/li>
&lt;/ul>
&lt;div style="text-align: center;">Build Drivers Comparison&lt;/div>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th style="text-align: left">Feature&lt;/th>
 &lt;th style="text-align: left">docker&lt;/th>
 &lt;th style="text-align: left">docker-container&lt;/th>
 &lt;th style="text-align: left">kubernetes&lt;/th>
 &lt;th style="text-align: left">remote&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td style="text-align: left">Automatically load image&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;td style="text-align: left">&lt;/td>
 &lt;td style="text-align: left">&lt;/td>
 &lt;td style="text-align: left">&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: left">Cache export&lt;/td>
 &lt;td style="text-align: left">âœ“*&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: left">Tarball output&lt;/td>
 &lt;td style="text-align: left">&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: left">Multi-arch images&lt;/td>
 &lt;td style="text-align: left">&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: left">BuildKit configuration&lt;/td>
 &lt;td style="text-align: left">&lt;/td>
 &lt;td style="text-align: left">âœ…&lt;/td>
 &lt;td style="text-align: left">&lt;/td>
 &lt;td style="text-align: left">Managed externally&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;div style="text-align: center;">* The docker driver doesn't support all cache export options&lt;/div>
&lt;h3 id="é»˜è®¤çš„-builder">é»˜è®¤çš„ Builder&lt;/h3>
&lt;p>docker engine ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ builder å®ä¾‹ï¼Œä¾‹å¦‚ &lt;code>default&lt;/code>ã€‚é»˜è®¤çš„é©±åŠ¨æ˜¯ &lt;code>docker&lt;/code>ï¼Œä¸æ”¯æŒå¤šå¹³å°æ„å»ºã€‚&lt;/p></description></item><item><title>è§£å†³Goåº”ç”¨åœ¨å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜</title><link>/posts/solve-timezone-issue-in-go-application-in-container/</link><pubDate>Sat, 18 Feb 2023 16:12:01 +0800</pubDate><guid>/posts/solve-timezone-issue-in-go-application-in-container/</guid><description>&lt;h2 id="å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜">å®¹å™¨ä¸­çš„æ—¶åŒºé—®é¢˜&lt;/h2>
&lt;p>åº”ç”¨ç›´æ¥è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šéœ€è¦è®¾ç½®æœåŠ¡å™¨æ—¶åŒºä¸ºä¸œå…«åŒºï¼Œç°åœ¨å¾ˆå¤šåº”ç”¨éƒ½æ˜¯éƒ¨ç½²åœ¨å®¹å™¨ä¸­äº†ï¼ŒåŒæ ·ä¹Ÿæ˜¯è¦è®¾ç½®å®¹å™¨é•œåƒçš„æ—¶åŒºã€‚&lt;/p>
&lt;p>è®¸å¤šå®¹å™¨é•œåƒé»˜è®¤æ—¶åŒºä¸º &lt;code>UTC&lt;/code> (&lt;a href="https://zh.wikipedia.org/zh-hans/%E5%8D%8F%E8%B0%83%E4%B8%96%E7%95%8C%E6%97%B6">Coordinated Universal Time åè°ƒä¸–ç•Œæ—¶&lt;/a>)ï¼Œæ¯”ä¸œå…«åŒºæ…¢å…«ä¸ªå°æ—¶ï¼Œå½“ç¨‹åºæ¶‰åŠæ•°æ®åº“å†™å…¥æ“ä½œæˆ–è€…æ—¥å¿—è®°å½•ç­‰åŠŸèƒ½æ—¶å°±ä¼šæœ‰æ—¶é—´å·®ã€‚&lt;/p>
&lt;p>å¸¸è§„è§£å†³æ–¹æ¡ˆä¸€èˆ¬ä¸¤å¤§ç±»&lt;/p>
&lt;ol>
&lt;li>build dockeré•œåƒæ—¶å°±æŠŠé•œåƒå†…çš„æ—¶åŒºè®¾ç½®ä¸º &lt;code>Asia/Shanghai&lt;/code>&lt;/li>
&lt;li>è¿è¡Œå®¹å™¨æ—¶æŠŠæœ¬åœ°æ—¶åŒºæ­£å¸¸çš„ä¸»æœºçš„æ—¶åŒºé…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="çœ‹ä¸€ä¸‹-go-æ˜¯å¦‚ä½•è¯»å–æ—¶åŒºæ–‡ä»¶å¹¶è®¾ç½®-timetime-çš„æ—¶åŒºçš„">çœ‹ä¸€ä¸‹ &lt;code>Go&lt;/code> æ˜¯å¦‚ä½•è¯»å–æ—¶åŒºæ–‡ä»¶å¹¶è®¾ç½® &lt;code>time.Time&lt;/code> çš„æ—¶åŒºçš„&lt;/h3>
&lt;p>&lt;code>Go&lt;/code> æºç  &lt;a href="https://github.com/golang/go/blob/master/src/time/zoneinfo_unix.go">src/time/zoneinfo_unix.go&lt;/a> ä¸­ä»£ç å’Œæ³¨é‡Šéƒ½å¾ˆæ¸…æ™°ğŸ‘&lt;/p>
&lt;pre>&lt;code class="language-golang">package time

import (
 &amp;quot;syscall&amp;quot;
)

// Many systems use /usr/share/zoneinfo, Solaris 2 has
// /usr/share/lib/zoneinfo, IRIX 6 has /usr/lib/locale/TZ,
// NixOS has /etc/zoneinfo.
var platformZoneSources = []string{
 &amp;quot;/usr/share/zoneinfo/&amp;quot;,
 &amp;quot;/usr/share/lib/zoneinfo/&amp;quot;,
 &amp;quot;/usr/lib/locale/TZ/&amp;quot;,
 &amp;quot;/etc/zoneinfo&amp;quot;,
}

func initLocal() {
 // consult $TZ to find the time zone to use.
 // no $TZ means use the system default /etc/localtime.
 // $TZ=&amp;quot;&amp;quot; means use UTC.
 // $TZ=&amp;quot;foo&amp;quot; or $TZ=&amp;quot;:foo&amp;quot; if foo is an absolute path, then the file pointed
 // by foo will be used to initialize timezone; otherwise, file
 // /usr/share/zoneinfo/foo will be used.

 tz, ok := syscall.Getenv(&amp;quot;TZ&amp;quot;)
 switch {
 case !ok:
 z, err := loadLocation(&amp;quot;localtime&amp;quot;, []string{&amp;quot;/etc&amp;quot;})
 if err == nil {
 localLoc = *z
 localLoc.name = &amp;quot;Local&amp;quot;
 return
 }
 case tz != &amp;quot;&amp;quot;:
 if tz[0] == ':' {
 tz = tz[1:]
 }
 if tz != &amp;quot;&amp;quot; &amp;amp;&amp;amp; tz[0] == '/' {
 if z, err := loadLocation(tz, []string{&amp;quot;&amp;quot;}); err == nil {
 localLoc = *z
 if tz == &amp;quot;/etc/localtime&amp;quot; {
 localLoc.name = &amp;quot;Local&amp;quot;
 } else {
 localLoc.name = tz
 }
 return
 }
 } else if tz != &amp;quot;&amp;quot; &amp;amp;&amp;amp; tz != &amp;quot;UTC&amp;quot; {
 if z, err := loadLocation(tz, platformZoneSources); err == nil {
 localLoc = *z
 return
 }
 }
 }

 // Fall back to UTC.
 localLoc.name = &amp;quot;UTC&amp;quot;
}
&lt;/code>&lt;/pre>
&lt;p>é¦–å…ˆæ£€æŸ¥æ˜¯å¦è®¾ç½®äº† &lt;code>TZ&lt;/code> ç¯å¢ƒå˜é‡&lt;/p></description></item></channel></rss>