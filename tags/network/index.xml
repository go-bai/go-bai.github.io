<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Network on gobai's blog</title><link>/tags/network/</link><description>Recent content in Network on gobai's blog</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Tue, 09 Apr 2024 22:16:24 +0800</lastBuildDate><atom:link href="/tags/network/index.xml" rel="self" type="application/rss+xml"/><item><title>无线转有线网络</title><link>/posts/wireless-to-wired-network/</link><pubDate>Tue, 09 Apr 2024 22:16:24 +0800</pubDate><guid>/posts/wireless-to-wired-network/</guid><description>通过无线网卡连接网络A(192.168.31.0/24), 无线网卡相当于WAN口，通过有线网卡接入网络B(192.168.1.0/24), 有线网卡相当于LAN口
准备一个ubuntu虚拟机router # 准备qcow2基础镜像 wget https://down.idc.wiki/Image/realServer-Template/current/qcow2/ubuntu22.qcow2 -O /var/lib/libvirt/images/ubuntu.qcow2 # 创建虚拟机以基础镜像为backing file的增量盘 qemu-img create -f qcow2 -F qcow2 -b /var/lib/libvirt/images/ubuntu.qcow2 /var/lib/libvirt/disks/router.qcow2 20G # 创建并启动虚拟机 virt-install --name router --memory 512 --vcpus 1 --disk /var/lib/libvirt/disks/router.qcow2,bus=sata --import --os-variant ubuntu22.10 --network bridge=br0 --noautoconsole # 设置自动启动 virsh autostart router 配置网络 将无线网卡透传进虚拟机 打开 virt-manager -&amp;gt; 双击 router domain -&amp;gt; 点击 Show virtual hardware details -&amp;gt; 点击 Add Hardware -&amp;gt; 点击 PCI Host Device -&amp;gt; 选择 Intel Corporation Wi-Fi 6 AX200 -&amp;gt; 点击 Finish</description></item><item><title>OpenWrt</title><link>/posts/openwrt/</link><pubDate>Sat, 06 Jan 2024 17:38:38 +0800</pubDate><guid>/posts/openwrt/</guid><description>很久没折腾OpenWrt了, 囊中羞涩, 没有其他合适的设备, 这次是在KVM虚机中运行使用(ALL IN BOOM!)
先亮个当前的穷人版家庭网络拓扑图
准备qcow2镜像 首先下载最新的镜像, 截止目前最新版为23.05.3, 我这里下载的是x86-64的镜像
wget https://mirror-03.infra.openwrt.org/releases/23.05.3/targets/x86/64/openwrt-23.05.3-x86-64-generic-ext4-combined.img.gz # 解压 gunzip openwrt-23.05.3-x86-64-generic-ext4-combined.img.gz # 这里因为我要作为KVM虚拟机的镜像, 所以转换为qcow2格式. 如果是在物理机上部署, 可以直接直接刷到U盘上. qemu-img convert -f raw openwrt-23.05.3-x86-64-generic-ext4-combined.img -O qcow2 /var/lib/libvirt/images/openwrt.qcow2 运行虚机 我是用libvirt来管理qemu/kvm虚拟机, 如果没安装要先安装
apt install virt-manager qemu bridge-utils -y 我这里将镜像复制到了/var/lib/libvirt/disks/目录下
qemu-img create -f qcow2 -F qcow2 -b /var/lib/libvirt/images/openwrt.qcow2 /var/lib/libvirt/disks/openwrt.qcow2 1G 使用virt-install运行,
# 运行, 这里网络指定的之前文章中创建的网桥网络br0 virt-install --name openwrt --memory 256 --vcpus 1 --network bridge=br0,model=virtio --disk path=/var/lib/libvirt/disks/openwrt.qcow2,bus=ide --import --autostart --osinfo detect=on,require=off --graphics vnc,listen=0.</description></item><item><title>dhclient</title><link>/posts/dhclient/</link><pubDate>Mon, 09 Oct 2023 21:37:55 +0800</pubDate><guid>/posts/dhclient/</guid><description>在机器上使用netplan+NetworkManager配置bridged network之后
最近经常电脑用着用着就不能联网了，发现enp1s0总是偶尔冒出一个ipv4地址，并且路由表会多出一个从enp1s0出去的default路由。后来看journalctl日志发现是dhclient搞的事情(学艺不精, 没第一时间联系起来)。
下面是部分日志：
➜ ~ journalctl -n 1000000 | grep '192.168.1.22\|enp1s0' ... 10月 09 20:14:25 gobai-SER dhclient[107299]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x4745a8ce) 10月 09 20:14:26 gobai-SER dhclient[73666]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x2cfc74b3) 10月 09 20:14:26 gobai-SER dhclient[157839]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.255.255.255 port 67 (xid=0x453b8549) 10月 09 20:14:28 gobai-SER dhclient[170251]: DHCPREQUEST for 192.168.1.22 on enp1s0 to 255.</description></item></channel></rss>