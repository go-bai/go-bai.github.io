<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Rke2 on gobai's blog</title><link>/tags/rke2/</link><description>Recent content in Rke2 on gobai's blog</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Mon, 01 Jul 2024 21:24:49 +0800</lastBuildDate><atom:link href="/tags/rke2/index.xml" rel="self" type="application/rss+xml"/><item><title>使用 RKE2 快速搭建 k8s 集群</title><link>/posts/rke2/</link><pubDate>Mon, 01 Jul 2024 21:24:49 +0800</pubDate><guid>/posts/rke2/</guid><description>&lt;p>根据&lt;a href="../creating-a-bridged-network-with-netplan-on-ubuntu-22-04/">创建 bridge 网络&lt;/a>和&lt;a href="../create-vm-with-cloudinit/">创建虚拟机时使用 cloudinit 初始化&lt;/a>创建虚拟机, 并配置静态ip如下&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>主机名&lt;/th>
 &lt;th>配置&lt;/th>
 &lt;th>ip (域名)&lt;/th>
 &lt;th>系统盘 / 数据盘&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>k8s-node01&lt;/td>
 &lt;td>8核16G&lt;/td>
 &lt;td>192.168.1.218 (&lt;code>lb.k8s.lan&lt;/code>)&lt;/td>
 &lt;td>50GB / 100GB*1&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-node02&lt;/td>
 &lt;td>8核16G&lt;/td>
 &lt;td>192.168.1.219&lt;/td>
 &lt;td>50GB / 100GB*1&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>k8s-node03&lt;/td>
 &lt;td>8核16G&lt;/td>
 &lt;td>192.168.1.220&lt;/td>
 &lt;td>50GB / 100GB*1&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;h2 id="安装-rke2">安装 RKE2&lt;/h2>
&lt;h3 id="安装第一个-server-节点">安装第一个 server 节点&lt;/h3>
&lt;p>在 k8s-node01 节点执行&lt;/p>
&lt;pre>&lt;code class="language-bash"># 初始化 rke2 配置文件
mkdir -p /etc/rancher/rke2
cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/rancher/rke2/config.yaml
tls-san:
 - lb.k8s.lan
write-kubeconfig-mode: &amp;quot;0600&amp;quot;
disable-cloud-controller: true
# 为了节省资源使用的 flannel, 也可以使用 calico
cni: flannel
debug: true
# 指定 kube-scheduler 自定义参数, 会自动覆盖到 /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml
kube-scheduler-arg:
 - v=4
 - bind-address=0.0.0.0
kube-controller-manager-arg:
 - bind-address=0.0.0.0
etcd-expose-metrics: true
EOF

curl -sfL https://rancher-mirror.rancher.cn/rke2/install.sh | INSTALL_RKE2_MIRROR=cn sh -
systemctl enable rke2-server.service
systemctl start rke2-server.service
&lt;/code>&lt;/pre>
&lt;h4 id="配置介绍">配置介绍&lt;/h4>
&lt;h5 id="tls-san">&lt;code>tls-san&lt;/code>&lt;/h5>
&lt;p>&lt;code>tls-san&lt;/code> 在 server 的 TLS 证书中增加了多个地址作为 &lt;code>Subject Alternative Name&lt;/code>, 这样 apiserver 就可以通过 &lt;code>lb.k8s.lan&lt;/code> 和 各个 server 节点 ip 访问.&lt;/p></description></item></channel></rss>